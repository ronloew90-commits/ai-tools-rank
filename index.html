<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-X2W323M13Z"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-X2W323M13Z');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <meta name="description" content="Find the best AI tools for specific tasks based on real user reviews">
    <meta name="theme-color" content="#4f46e5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>AI Tools Rank - Find the Best AI Tool for Your Task</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <!-- DOMPurify for XSS prevention -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
    
    <!-- Google reCAPTCHA v2 -->
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Plus Jakarta Sans', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes pulse-glow {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }
        
        .float-animation {
            animation: float 6s ease-in-out infinite;
        }
        
        .glow-animation {
            animation: pulse-glow 3s ease-in-out infinite;
        }
        
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px -12px rgba(99, 102, 241, 0.15);
        }
        
        .btn-press:active {
            transform: scale(0.97);
        }
        
        .star-hover:hover {
            transform: scale(1.15);
        }
        
        .chip-selected {
            background: linear-gradient(135deg, #4f46e5, #7c3aed) !important;
            color: white !important;
            border-color: transparent !important;
            box-shadow: 0 4px 14px -3px rgba(99, 102, 241, 0.4);
        }
        
        .glassmorphism {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .highlight-text {
            background: #fef08a;
            padding: 0 4px;
            border-radius: 4px;
        }
        
        /* Reviews expandable */
        .reviews-expandable {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        
        .reviews-expandable.expanded {
            max-height: 2000px;
            transition: max-height 0.5s ease-in;
        }
        
        /* Messages */
        .message {
            display: none;
            animation: slideIn 0.3s ease-out;
        }
        
        .message.show {
            display: flex;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Skeleton loading */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: 16px;
        }
        
        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        .skeleton-card {
            height: 180px;
            margin-bottom: 1rem;
        }
        
        /* Mobile adjustments */
        @media (max-width: 640px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr) !important;
            }
            .stats-divider:nth-child(2)::after {
                display: none;
            }
        }
    </style>
</head>
<body class="min-h-screen bg-slate-50">
    <!-- Pull to Refresh Indicator -->
    <div id="pullIndicator" class="fixed top-16 left-1/2 -translate-x-1/2 -translate-y-full bg-white px-4 py-2 rounded-full shadow-lg text-sm text-slate-600 opacity-0 transition-all duration-300 z-50">
        <span id="pullText">‚Üì Pull to refresh</span>
    </div>
    
    <style>
        #pullIndicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        #pullIndicator.refreshing {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
        }
    </style>

    <!-- Decorative Background -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="absolute top-0 left-1/4 w-96 h-96 bg-indigo-200/30 rounded-full blur-3xl glow-animation"></div>
        <div class="absolute top-1/3 right-1/4 w-80 h-80 bg-violet-200/30 rounded-full blur-3xl glow-animation" style="animation-delay: 1s;"></div>
        <div class="absolute bottom-1/4 left-1/3 w-72 h-72 bg-pink-200/20 rounded-full blur-3xl glow-animation" style="animation-delay: 2s;"></div>
    </div>

    <!-- Header -->
    <header class="relative border-b border-slate-200/50 bg-white/80 backdrop-blur-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 py-4 flex items-center">
            <a href="#" onclick="location.reload(); return false;" class="flex items-center gap-3">
                <div class="bg-gradient-to-br from-indigo-600 to-violet-600 p-2.5 rounded-xl shadow-lg shadow-indigo-200">
                    <i data-lucide="bar-chart-3" class="w-5 h-5 sm:w-6 sm:h-6 text-white"></i>
                </div>
                <span class="text-lg sm:text-xl font-bold text-slate-800">AI Tools Rank</span>
            </a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="relative max-w-7xl mx-auto px-4 sm:px-6 py-8 sm:py-12">
        
        <!-- Hero Section -->
        <div class="text-center mb-10 sm:mb-12">
            <!-- Badge -->
            <div class="inline-flex items-center gap-2 bg-indigo-100 text-indigo-700 px-4 py-2 rounded-full text-sm font-medium mb-6">
                <i data-lucide="sparkles" class="w-4 h-4"></i>
                Crowd-sourced AI Tool Rankings
            </div>
            
            <!-- Title -->
            <h1 class="text-3xl sm:text-5xl md:text-6xl font-extrabold text-slate-800 mb-4 tracking-tight">
                Find the <span class="gradient-text">Best AI Tool</span>
                <br class="hidden sm:block">for Your Task
            </h1>
            
            <!-- Subtitle -->
            <p class="text-lg sm:text-xl text-slate-500 max-w-2xl mx-auto mb-8 sm:mb-10 px-4">
                Real reviews from real users. Discover which AI tools actually deliver results.
            </p>

            <!-- Action Cards -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6 max-w-3xl mx-auto mb-10 sm:mb-12 px-4">
                <!-- Search Card -->
                <div class="card-hover bg-white rounded-2xl p-6 sm:p-8 text-center border border-slate-100 shadow-sm cursor-pointer" onclick="document.getElementById('searchInput').focus(); document.getElementById('searchInput').scrollIntoView({behavior: 'smooth', block: 'center'});">
                    <div class="w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-br from-indigo-500 to-violet-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg shadow-indigo-200">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8 sm:w-10 sm:h-10">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="m21 21-4.3-4.3"/>
                        </svg>
                    </div>
                    <h3 class="text-xl sm:text-2xl font-bold text-slate-800 mb-2">Search AI Tools</h3>
                    <p class="text-slate-500 text-sm sm:text-base mb-5">Find AI tools by category, task description, ratings, or price range with our intelligent search.</p>
                    <button class="w-full bg-gradient-to-r from-indigo-500 to-violet-600 hover:from-indigo-600 hover:to-violet-700 text-white font-semibold py-3 sm:py-4 px-6 rounded-xl transition-all duration-200 btn-press shadow-md shadow-indigo-200">
                        Start Searching
                    </button>
                </div>

                <!-- Rate Card -->
                <div class="card-hover bg-white rounded-2xl p-6 sm:p-8 text-center border border-slate-100 shadow-sm cursor-pointer" onclick="document.getElementById('ratingForm').scrollIntoView({behavior: 'smooth', block: 'start'});">
                    <div class="w-16 h-16 sm:w-20 sm:h-20 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg" style="background: linear-gradient(to bottom right, #14B8A6, #0D9488); box-shadow: 0 10px 15px -3px rgba(13, 148, 136, 0.3);">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8 sm:w-10 sm:h-10">
                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                        </svg>
                    </div>
                    <h3 class="text-xl sm:text-2xl font-bold text-slate-800 mb-2">Rate an AI Tool</h3>
                    <p class="text-slate-500 text-sm sm:text-base mb-5">Share your experience and help others discover great AI tools through authentic reviews.</p>
                    <button class="w-full text-white font-semibold py-3 sm:py-4 px-6 rounded-xl transition-all duration-200 btn-press" style="background: linear-gradient(to right, #14B8A6, #0D9488); box-shadow: 0 4px 6px -1px rgba(13, 148, 136, 0.3);" onmouseover="this.style.background='linear-gradient(to right, #0F9D8F, #0B857A)'" onmouseout="this.style.background='linear-gradient(to right, #14B8A6, #0D9488)'">
                        Add Rating
                    </button>
                </div>
            </div>

            <!-- Stats Bar - Glassmorphism -->
            <div class="max-w-3xl mx-auto relative px-4">
                <div class="glassmorphism border border-white/50 rounded-2xl sm:rounded-3xl shadow-xl shadow-slate-200/50 p-2">
                    <div class="grid grid-cols-2 sm:grid-cols-4 stats-grid">
                        <div class="flex flex-col items-center py-3 sm:py-4 px-2 sm:px-6 group cursor-default stats-divider relative">
                            <div class="text-indigo-600 mb-1 sm:mb-2 transform transition-transform group-hover:scale-110">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 sm:w-7 sm:h-7">
                                    <path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"/>
                                    <path d="m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"/>
                                    <path d="m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"/>
                                </svg>
                            </div>
                            <div class="text-xl sm:text-2xl font-bold text-slate-800" id="toolCount">-</div>
                            <div class="text-xs text-slate-500 uppercase tracking-wider">Tools</div>
                            <div class="absolute right-0 top-1/4 h-1/2 w-px bg-slate-200/50 hidden sm:block"></div>
                        </div>
                        <div class="flex flex-col items-center py-3 sm:py-4 px-2 sm:px-6 group cursor-default stats-divider relative">
                            <div class="text-emerald-600 mb-1 sm:mb-2 transform transition-transform group-hover:scale-110">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 sm:w-7 sm:h-7">
                                    <path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/>
                                </svg>
                            </div>
                            <div class="text-xl sm:text-2xl font-bold text-slate-800" id="ratingCount">-</div>
                            <div class="text-xs text-slate-500 uppercase tracking-wider">Reviews</div>
                            <div class="absolute right-0 top-1/4 h-1/2 w-px bg-slate-200/50 hidden sm:block"></div>
                        </div>
                        <div class="flex flex-col items-center py-3 sm:py-4 px-2 sm:px-6 group cursor-default stats-divider relative">
                            <div class="text-violet-600 mb-1 sm:mb-2 transform transition-transform group-hover:scale-110">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 sm:w-7 sm:h-7">
                                    <line x1="18" x2="18" y1="20" y2="10"/>
                                    <line x1="12" x2="12" y1="20" y2="4"/>
                                    <line x1="6" x2="6" y1="20" y2="14"/>
                                </svg>
                            </div>
                            <div class="text-xl sm:text-2xl font-bold text-slate-800" id="taskCount">-</div>
                            <div class="text-xs text-slate-500 uppercase tracking-wider">Tasks</div>
                            <div class="absolute right-0 top-1/4 h-1/2 w-px bg-slate-200/50 hidden sm:block"></div>
                        </div>
                        <div class="flex flex-col items-center py-3 sm:py-4 px-2 sm:px-6 group cursor-default">
                            <div class="text-amber-500 mb-1 sm:mb-2 transform transition-transform group-hover:scale-110">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 sm:w-7 sm:h-7">
                                    <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/>
                                    <polyline points="16 7 22 7 22 13"/>
                                </svg>
                            </div>
                            <div class="text-xl sm:text-2xl font-bold text-slate-800" id="avgRating">-</div>
                            <div class="text-xs text-slate-500 uppercase tracking-wider">Avg Rating</div>
                        </div>
                    </div>
                </div>
                <!-- Decorative gradient blur -->
                <div class="absolute -inset-4 bg-gradient-to-r from-indigo-500/20 via-purple-500/20 to-pink-500/20 rounded-3xl blur-2xl -z-10"></div>
            </div>
        </div>

        <!-- Search Bar -->
        <div class="relative max-w-2xl mx-auto mb-10 sm:mb-12 px-4">
            <form onsubmit="performSearch(event); return false;" class="relative">
                <i data-lucide="search" class="absolute left-4 sm:left-5 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"></i>
                <input
                    type="text"
                    id="searchInput"
                    placeholder="What task do you need help with?"
                    maxlength="200"
                    autocomplete="off"
                    class="w-full pl-12 sm:pl-14 pr-24 sm:pr-32 py-4 sm:py-5 rounded-xl sm:rounded-2xl border border-slate-200 shadow-sm focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition-all outline-none text-slate-800 placeholder:text-slate-400 text-base sm:text-lg"
                >
                <button
                    type="submit"
                    id="searchBtn"
                    class="absolute right-2 sm:right-3 top-1/2 -translate-y-1/2 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-4 sm:px-6 py-2.5 sm:py-3 rounded-lg sm:rounded-xl transition-all duration-200 btn-press shadow-md shadow-indigo-200"
                >
                    Search
                </button>
            </form>
        </div>

        <!-- Search Results -->
        <div id="resultsSection" class="mb-12 sm:mb-16 px-4">
            <div id="searchResults">
                <div class="text-center py-8 text-slate-500">
                    <i data-lucide="search" class="w-12 h-12 mx-auto mb-4 text-slate-300"></i>
                    <p class="text-lg">Search for a task to find the best AI tools</p>
                    <p class="text-sm mt-2">Try "write marketing copy" or "generate images"</p>
                </div>
            </div>
        </div>

        <!-- Rate a Tool Form -->
        <div class="max-w-2xl mx-auto px-4">
            <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                <!-- Header -->
                <div class="bg-gradient-to-r from-indigo-600 to-violet-600 px-5 sm:px-6 py-5">
                    <div class="flex items-center gap-3">
                        <div class="bg-white/20 p-2.5 rounded-xl">
                            <i data-lucide="sparkles" class="w-5 h-5 sm:w-6 sm:h-6 text-white"></i>
                        </div>
                        <div>
                            <h2 class="text-lg sm:text-xl font-bold text-white">Rate an AI Tool</h2>
                            <p class="text-indigo-100 text-sm">Share your experience and help others</p>
                        </div>
                    </div>
                </div>

                <!-- Form -->
                <form id="ratingForm" class="p-5 sm:p-6 space-y-5 sm:space-y-6" novalidate>
                    <!-- Messages -->
                    <div class="message items-center gap-2 p-4 rounded-xl bg-emerald-50 text-emerald-700 border border-emerald-200" id="successMessage">
                        <i data-lucide="check-circle" class="w-5 h-5"></i>
                        <span id="successText">Rating saved!</span>
                    </div>
                    
                    <div class="message items-center gap-2 p-4 rounded-xl bg-red-50 text-red-700 border border-red-200" id="errorMessage">
                        <i data-lucide="alert-circle" class="w-5 h-5"></i>
                        <span id="errorText">Something went wrong</span>
                    </div>
                    
                    <!-- Tool Name -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">
                            Tool Name <span class="text-rose-500">*</span>
                        </label>
                        <input
                            type="text"
                            id="toolName"
                            required
                            maxlength="50"
                            placeholder="e.g., ChatGPT, Midjourney"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition-all outline-none text-slate-800 placeholder:text-slate-400"
                        >
                    </div>

                    <!-- Task Description -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">
                            What did you use it for? <span class="text-rose-500">*</span>
                        </label>
                        <textarea
                            id="taskDescription"
                            required
                            maxlength="200"
                            placeholder="Describe the task you used this tool for..."
                            rows="2"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition-all outline-none text-slate-800 placeholder:text-slate-400 resize-none"
                        ></textarea>
                        <div class="text-right text-xs text-slate-400 mt-1" id="taskCounter">0/200</div>
                    </div>

                    <!-- Task Type Chips -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-3">
                            Task Type <span class="text-slate-400">(optional)</span>
                        </label>
                        <div class="flex flex-wrap gap-2" id="taskTypeChips">
                            <button type="button" data-type="Writing" class="task-chip px-4 py-2 rounded-full text-sm font-medium bg-white text-slate-600 border border-slate-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all btn-press">‚úçÔ∏è Writing</button>
                            <button type="button" data-type="Image generation" class="task-chip px-4 py-2 rounded-full text-sm font-medium bg-white text-slate-600 border border-slate-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all btn-press">üé® Image Gen</button>
                            <button type="button" data-type="Data analysis" class="task-chip px-4 py-2 rounded-full text-sm font-medium bg-white text-slate-600 border border-slate-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all btn-press">üìä Data</button>
                            <button type="button" data-type="Coding" class="task-chip px-4 py-2 rounded-full text-sm font-medium bg-white text-slate-600 border border-slate-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all btn-press">üíª Coding</button>
                            <button type="button" data-type="Research" class="task-chip px-4 py-2 rounded-full text-sm font-medium bg-white text-slate-600 border border-slate-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all btn-press">üî¨ Research</button>
                            <button type="button" data-type="Planning" class="task-chip px-4 py-2 rounded-full text-sm font-medium bg-white text-slate-600 border border-slate-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all btn-press">üìã Planning</button>
                            <button type="button" data-type="Marketing" class="task-chip px-4 py-2 rounded-full text-sm font-medium bg-white text-slate-600 border border-slate-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all btn-press">üì¢ Marketing</button>
                            <button type="button" data-type="Design" class="task-chip px-4 py-2 rounded-full text-sm font-medium bg-white text-slate-600 border border-slate-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all btn-press">üéØ Design</button>
                            <button type="button" data-type="Automation" class="task-chip px-4 py-2 rounded-full text-sm font-medium bg-white text-slate-600 border border-slate-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all btn-press">‚öôÔ∏è Automation</button>
                            <button type="button" data-type="Audio/Video" class="task-chip px-4 py-2 rounded-full text-sm font-medium bg-white text-slate-600 border border-slate-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all btn-press">üé¨ Audio/Video</button>
                            <button type="button" data-type="Translation" class="task-chip px-4 py-2 rounded-full text-sm font-medium bg-white text-slate-600 border border-slate-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all btn-press">üåç Translation</button>
                            <button type="button" data-type="Other" class="task-chip px-4 py-2 rounded-full text-sm font-medium bg-white text-slate-600 border border-slate-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all btn-press">üìÅ Other</button>
                        </div>
                    </div>

                    <!-- Feedback -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">
                            Your Feedback <span class="text-rose-500">*</span>
                        </label>
                        <textarea
                            id="userFeedback"
                            required
                            maxlength="500"
                            placeholder="What worked well? What didn't?"
                            rows="3"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition-all outline-none text-slate-800 placeholder:text-slate-400 resize-none"
                        ></textarea>
                        <div class="text-right text-xs text-slate-400 mt-1" id="feedbackCounter">0/500</div>
                    </div>

                    <!-- Pricing -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">
                            Pricing <span class="text-slate-400">(optional)</span>
                        </label>
                        <select id="toolPrice" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition-all outline-none text-slate-800 bg-white">
                            <option value="">Select pricing...</option>
                            <option value="Free">Free</option>
                            <option value="Free with limits">Free (limited)</option>
                            <option value="$1-10/month">$1-10/mo</option>
                            <option value="$11-20/month">$11-20/mo</option>
                            <option value="$21-50/month">$21-50/mo</option>
                            <option value="$50+/month">$50+/mo</option>
                            <option value="Usage-based">Usage-based</option>
                        </select>
                    </div>

                    <!-- Rating Stars -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-3">
                            Your Rating <span class="text-rose-500">*</span>
                        </label>
                        <div class="flex gap-1" id="starRating">
                            <button type="button" data-rating="1" class="star-btn transition-transform star-hover p-1">
                                <i data-lucide="star" class="w-8 h-8 fill-slate-200 text-slate-300 star-icon"></i>
                            </button>
                            <button type="button" data-rating="2" class="star-btn transition-transform star-hover p-1">
                                <i data-lucide="star" class="w-8 h-8 fill-slate-200 text-slate-300 star-icon"></i>
                            </button>
                            <button type="button" data-rating="3" class="star-btn transition-transform star-hover p-1">
                                <i data-lucide="star" class="w-8 h-8 fill-slate-200 text-slate-300 star-icon"></i>
                            </button>
                            <button type="button" data-rating="4" class="star-btn transition-transform star-hover p-1">
                                <i data-lucide="star" class="w-8 h-8 fill-slate-200 text-slate-300 star-icon"></i>
                            </button>
                            <button type="button" data-rating="5" class="star-btn transition-transform star-hover p-1">
                                <i data-lucide="star" class="w-8 h-8 fill-slate-200 text-slate-300 star-icon"></i>
                            </button>
                        </div>
                    </div>

                    <!-- reCAPTCHA -->
                    <div class="flex flex-col items-center py-4">
                        <div class="g-recaptcha" data-sitekey="6LfBRhgsAAAAAMJGVjoRF3to6p8LsssvTSs3lpRR" data-callback="onCaptchaSuccess" data-expired-callback="onCaptchaExpired"></div>
                        <div class="text-rose-500 text-sm mt-2 hidden" id="captchaError">Please complete the CAPTCHA</div>
                        <p class="text-xs text-slate-400 mt-2">Please verify you're human</p>
                    </div>

                    <!-- Submit Button -->
                    <button
                        type="submit"
                        id="submitBtn"
                        class="w-full bg-gradient-to-r from-indigo-600 to-violet-600 hover:from-indigo-700 hover:to-violet-700 text-white font-semibold py-4 px-6 rounded-xl shadow-lg shadow-indigo-200 transform transition-all duration-200 hover:shadow-xl hover:-translate-y-0.5 btn-press focus:outline-none focus:ring-4 focus:ring-indigo-100"
                    >
                        <span id="submitBtnText">Submit Rating</span>
                    </button>
                </form>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="relative border-t border-slate-200 bg-white/80 backdrop-blur-lg mt-16">
        <div class="max-w-7xl mx-auto px-6 py-8 text-center">
            <p class="text-slate-500 mb-4">AI Tools Rank ‚Äî Helping you find the best AI tools for your tasks</p>
            <a 
                href="https://www.linkedin.com/in/ron-lev-1269137a/" 
                target="_blank" 
                rel="noopener noreferrer"
                class="inline-flex items-center gap-2 text-indigo-600 hover:text-indigo-800 font-semibold transition-colors"
            >
                Built by Ron Lev üîó
            </a>
        </div>
    </footer>

    <script>
        'use strict';

        // Initialize Lucide icons
        lucide.createIcons();

        // ====================================
        // CONFIGURATION
        // ====================================
        
        const CONFIG = Object.freeze({
            FIREBASE: {
                apiKey: "AIzaSyBfEWQo79qbO10AMwsmaODqu7u_C_m2HGg",
                authDomain: "ai-tools-rank.firebaseapp.com",
                projectId: "ai-tools-rank",
                storageBucket: "ai-tools-rank.firebasestorage.app",
                messagingSenderId: "332988419959",
                appId: "1:332988419959:web:3d4eb8552f3205fcb79b72"
            },
            LIMITS: {
                MAX_LOCAL_STORAGE: 1000000,
                MAX_RATINGS_DISPLAY: 50,
                MAX_RATINGS_STORE: 500,
                SEARCH_DEBOUNCE: 300,
                SUBMIT_COOLDOWN: 2000,
                MIN_SEARCH_LENGTH: 2,
                MAX_SEARCH_LENGTH: 200,
                MAX_TOOL_NAME: 50,
                MAX_TASK_DESC: 200,
                MAX_FEEDBACK: 500
            }
        });

        // Global state
        const AppState = {
            db: null,
            isConnected: false,
            selectedRating: 0,
            selectedTaskType: null,
            allRatings: [],
            isSubmitting: false,
            searchTimeout: null,
            lastSubmitTime: 0,
            isMobile: /iPhone|iPad|iPod|Android/i.test(navigator.userAgent),
            isLoading: true,
            captchaVerified: false,
            isPulling: false
        };

        // reCAPTCHA callbacks
        function onCaptchaSuccess(token) {
            AppState.captchaVerified = true;
            document.getElementById('captchaError').classList.add('hidden');
        }

        function onCaptchaExpired() {
            AppState.captchaVerified = false;
        }

        // ====================================
        // SECURITY FUNCTIONS
        // ====================================
        
        function sanitizeHTML(str) {
            if (!str) return '';
            if (typeof DOMPurify !== 'undefined') {
                return DOMPurify.sanitize(str, { ALLOWED_TAGS: [] });
            }
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function validateInput(value, maxLength) {
            if (!value || typeof value !== 'string') return false;
            if (value.length > maxLength) return false;
            return true;
        }

        function validateRating(rating) {
            return Number.isInteger(rating) && rating >= 1 && rating <= 5;
        }

        function canSubmit() {
            const now = Date.now();
            const timeSinceLastSubmit = now - AppState.lastSubmitTime;
            return !AppState.isSubmitting && timeSinceLastSubmit > CONFIG.LIMITS.SUBMIT_COOLDOWN;
        }

        // ====================================
        // INITIALIZATION
        // ====================================
        
        function initializeApp() {
            console.log('Initializing app...');
            
            // Mobile viewport height handling
            updateViewportHeight();
            window.addEventListener('resize', updateViewportHeight);
            window.addEventListener('orientationchange', () => {
                setTimeout(updateViewportHeight, 100);
            });
            
            // Mobile-specific adjustments
            if (AppState.isMobile) {
                document.body.classList.add('mobile');
                setupPullToRefresh();
                setupKeyboardHandling();
            }
            
            if (typeof firebase !== 'undefined') {
                initializeFirebase();
            } else {
                loadFirebaseFallback();
            }
            
            setupEventListeners();
            updateCharCounter('taskDescription');
            updateCharCounter('userFeedback');
        }

        // Viewport height calculation for mobile
        function updateViewportHeight() {
            const vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        }

        // Pull to refresh for mobile
        function setupPullToRefresh() {
            let startY = 0;
            let currentY = 0;
            const pullIndicator = document.getElementById('pullIndicator');
            const pullText = document.getElementById('pullText');
            
            if (!pullIndicator) return;
            
            document.addEventListener('touchstart', (e) => {
                if (window.scrollY === 0) {
                    startY = e.touches[0].pageY;
                    AppState.isPulling = true;
                }
            }, { passive: true });
            
            document.addEventListener('touchmove', (e) => {
                if (!AppState.isPulling || window.scrollY > 0) return;
                
                currentY = e.touches[0].pageY;
                const pullDistance = currentY - startY;
                
                if (pullDistance > 0 && pullDistance < 150) {
                    pullIndicator.classList.add('visible');
                    
                    if (pullDistance > 80) {
                        pullText.textContent = '‚Üë Release to refresh';
                    } else {
                        pullText.textContent = '‚Üì Pull to refresh';
                    }
                }
            }, { passive: true });
            
            document.addEventListener('touchend', () => {
                const pullDistance = currentY - startY;
                
                if (AppState.isPulling && pullDistance > 80 && window.scrollY === 0) {
                    pullIndicator.classList.add('refreshing');
                    pullText.textContent = '‚ü≥ Refreshing...';
                    
                    setTimeout(() => {
                        location.reload();
                    }, 500);
                } else {
                    pullIndicator.classList.remove('visible');
                }
                
                AppState.isPulling = false;
                startY = 0;
                currentY = 0;
            }, { passive: true });
        }

        // Keyboard handling for mobile
        function setupKeyboardHandling() {
            const inputs = document.querySelectorAll('input, textarea, select');
            
            inputs.forEach(input => {
                input.addEventListener('focus', () => {
                    setTimeout(() => {
                        input.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 300);
                });
            });

            if (window.visualViewport) {
                window.visualViewport.addEventListener('resize', () => {
                    const activeEl = document.activeElement;
                    if (activeEl && (activeEl.tagName === 'INPUT' || activeEl.tagName === 'TEXTAREA')) {
                        activeEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                });
            }
        }

        function initializeFirebase() {
            try {
                firebase.initializeApp(CONFIG.FIREBASE);
                AppState.db = firebase.firestore();
                
                AppState.db.enablePersistence({ synchronizeTabs: true })
                    .catch(err => console.warn('Persistence failed:', err));
                
                AppState.db.collection('ratings').limit(1).get()
                    .then(() => {
                        AppState.isConnected = true;
                        updateConnectionStatus('connected');
                        loadRatings();
                    })
                    .catch(error => {
                        if (error.code === 'permission-denied') {
                            AppState.isConnected = true;
                            updateConnectionStatus('write-only');
                        } else {
                            updateConnectionStatus('offline');
                        }
                        loadLocalRatings();
                    });
            } catch (error) {
                console.error('Firebase error:', error);
                initializeOfflineMode();
            }
        }

        function loadFirebaseFallback() {
            initializeOfflineMode();
        }

        function initializeOfflineMode() {
            AppState.isConnected = false;
            updateConnectionStatus('offline');
            loadLocalRatings();
        }

        // ====================================
        // DATA MANAGEMENT
        // ====================================
        
        async function loadRatings() {
            AppState.isLoading = true;
            
            try {
                const snapshot = await AppState.db.collection('ratings')
                    .orderBy('createdAt', 'desc')
                    .limit(CONFIG.LIMITS.MAX_RATINGS_STORE)
                    .get();
                
                AppState.allRatings = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                updateStats();
            } catch (error) {
                console.error('Error loading:', error);
                loadLocalRatings();
            } finally {
                AppState.isLoading = false;
            }
        }

        function loadLocalRatings() {
            AppState.isLoading = true;
            
            try {
                const stored = localStorage.getItem('aiToolRatings');
                if (stored) {
                    AppState.allRatings = JSON.parse(stored);
                } else {
                    AppState.allRatings = [
                        { id: 'demo1', toolName: 'ChatGPT', task: 'write marketing copy', feedback: 'Great for content', rating: 5, price: 'Free' },
                        { id: 'demo2', toolName: 'Claude', task: 'analyze data', feedback: 'Excellent analysis', rating: 5, price: '$20/month' },
                        { id: 'demo3', toolName: 'Midjourney', task: 'generate images', feedback: 'Amazing quality', rating: 5, price: '$10/month' }
                    ];
                }
                updateStats();
            } catch (error) {
                console.error('Local storage error:', error);
            } finally {
                AppState.isLoading = false;
            }
        }

        function saveLocalRatings() {
            try {
                const data = JSON.stringify(AppState.allRatings.slice(0, CONFIG.LIMITS.MAX_RATINGS_STORE));
                if (data.length < CONFIG.LIMITS.MAX_LOCAL_STORAGE) {
                    localStorage.setItem('aiToolRatings', data);
                }
            } catch (error) {
                console.error('Save error:', error);
            }
        }

        // ====================================
        // SEARCH
        // ====================================
        
        function normalizeToolName(name) {
            return name.toLowerCase().replace(/[^a-z0-9]/g, '');
        }

        // Synonym mapping for better search results
        // Maps search terms to related terms (more precise matching)
        const synonymMap = {
            // Image-related
            'photo': ['image', 'picture', 'visual'],
            'picture': ['image', 'photo', 'visual'],
            'image': ['photo', 'picture', 'visual', 'graphic'],
            'visual': ['image', 'graphic'],
            'illustration': ['image', 'graphic', 'art'],
            
            // Code-related
            'coding': ['code', 'programming', 'developer'],
            'programming': ['code', 'coding', 'developer'],
            'code': ['coding', 'programming'],
            'debug': ['debugging', 'code', 'fix'],
            'debugging': ['debug', 'code', 'fix'],
            
            // Writing sub-types (more granular)
            'blog': ['article', 'post'],
            'article': ['blog', 'post'],
            'post': ['blog', 'article'],
            'email': ['message', 'draft'],
            'copy': ['copywriting', 'advertising'],
            'copywriting': ['copy', 'advertising', 'marketing'],
            
            // Data-related
            'data': ['analysis', 'analytics', 'csv'],
            'analytics': ['analysis', 'data'],
            'analysis': ['analytics', 'data', 'analyze'],
            'analyze': ['analyse', 'analysis'],
            'analyse': ['analyze', 'analysis'],
            'spreadsheet': ['csv', 'excel', 'data'],
            'csv': ['spreadsheet', 'data', 'excel'],
            
            // Research-related
            'research': ['investigate', 'find', 'lookup'],
            'investigate': ['research', 'find'],
            
            // Marketing-related
            'marketing': ['advertising', 'campaign', 'promotion'],
            'advertise': ['advertising', 'marketing', 'ads'],
            'advertising': ['marketing', 'ads', 'campaign'],
            'campaign': ['marketing', 'advertising'],
            'ads': ['advertising', 'marketing'],
            
            // Generation-related
            'generate': ['create', 'make', 'produce'],
            'create': ['generate', 'make', 'build'],
            'make': ['create', 'generate', 'build']
        };

        // Expand search terms with synonyms
        function expandWithSynonyms(words) {
            const expanded = new Set(words);
            words.forEach(word => {
                // Add synonyms if this word has mappings
                if (synonymMap[word]) {
                    synonymMap[word].forEach(syn => expanded.add(syn));
                }
            });
            return Array.from(expanded);
        }

        // Bayesian Average calculation for fairer ranking
        function calculateBayesianScore(avgRating, reviewCount) {
            const C = 5;    // Confidence threshold (minimum reviews for full weight)
            const m = 3.5;  // Baseline/prior rating
            const v = reviewCount;
            const R = avgRating;
            
            // Bayesian Average: (v / (v + C)) * R + (C / (v + C)) * m
            return (v / (v + C)) * R + (C / (v + C)) * m;
        }

        function findBestToolsForTask(searchTask) {
            if (!searchTask || searchTask.length < CONFIG.LIMITS.MIN_SEARCH_LENGTH) return [];
            
            // Get search words and expand with synonyms
            const rawSearchWords = searchTask.toLowerCase().split(/\s+/).filter(w => w.length > 2);
            const searchWords = expandWithSynonyms(rawSearchWords);
            
            const results = new Map();
            
            AppState.allRatings.forEach(rating => {
                // Get words from all searchable fields (don't expand - keep original)
                const taskText = (rating.task || '').toLowerCase();
                const taskTypeText = (rating.taskType || '').toLowerCase();
                const feedbackText = (rating.feedback || '').toLowerCase();
                const toolNameText = (rating.toolName || '').toLowerCase();
                
                const taskWords = taskText.split(/\s+/).filter(w => w.length > 2);
                const taskTypeWords = taskTypeText.split(/\s+/).filter(w => w.length > 2);
                const feedbackWords = feedbackText.split(/\s+/).filter(w => w.length > 2);
                const toolNameWords = toolNameText.split(/\s+/).filter(w => w.length > 2);
                const allWords = [...taskWords, ...taskTypeWords, ...feedbackWords, ...toolNameWords];
                
                let similarity = 0;
                let matchedOriginalTerm = false;
                
                // Check each search word (including expanded synonyms)
                searchWords.forEach(sw => {
                    // Check if this is an original search term (not a synonym)
                    const isOriginalTerm = rawSearchWords.includes(sw);
                    
                    // Exact match in task description (highest priority)
                    if (taskWords.includes(sw)) {
                        similarity += isOriginalTerm ? 50 : 25;
                        if (isOriginalTerm) matchedOriginalTerm = true;
                    }
                    // Exact match in task type (high priority)
                    else if (taskTypeWords.includes(sw)) {
                        similarity += isOriginalTerm ? 30 : 15;
                        if (isOriginalTerm) matchedOriginalTerm = true;
                    }
                    // Exact match in tool name
                    else if (toolNameWords.includes(sw)) {
                        similarity += isOriginalTerm ? 25 : 12;
                        if (isOriginalTerm) matchedOriginalTerm = true;
                    }
                    // Exact match in feedback
                    else if (feedbackWords.includes(sw)) {
                        similarity += isOriginalTerm ? 35 : 15;
                        if (isOriginalTerm) matchedOriginalTerm = true;
                    }
                    // Partial match anywhere
                    else if (allWords.some(w => w.includes(sw) || sw.includes(w))) {
                        similarity += isOriginalTerm ? 10 : 5;
                        if (isOriginalTerm) matchedOriginalTerm = true;
                    }
                });
                
                // Only include results that matched at least one original search term
                // OR have high similarity from synonym matches
                if (matchedOriginalTerm && similarity > 20) {
                    const key = normalizeToolName(rating.toolName);
                    if (!results.has(key)) {
                        results.set(key, {
                            name: rating.toolName,
                            ratings: [],
                            tasks: [],
                            maxSimilarity: 0
                        });
                    }
                    
                    const tool = results.get(key);
                    tool.ratings.push(rating.rating);
                    tool.maxSimilarity = Math.max(tool.maxSimilarity, similarity);
                    tool.tasks.push({
                        task: rating.task,
                        taskType: rating.taskType || null,
                        feedback: rating.feedback,
                        rating: rating.rating,
                        createdAt: rating.createdAt,
                        similarity: similarity
                    });
                }
            });
            
            return Array.from(results.values())
                .map(tool => {
                    const avgRating = tool.ratings.reduce((a, b) => a + b, 0) / tool.ratings.length;
                    const reviewCount = tool.ratings.length;
                    const bayesianScore = calculateBayesianScore(avgRating, reviewCount);
                    
                    // Weighted score: relevance matters more than just rating
                    // Formula: (relevance * 2) + (bayesianScore * 10)
                    const weightedScore = (tool.maxSimilarity * 2) + (bayesianScore * 10);
                    
                    return {
                        name: tool.name,
                        avgRating: avgRating,
                        bayesianScore: bayesianScore,
                        relevance: tool.maxSimilarity,
                        weightedScore: weightedScore,
                        reviewCount: reviewCount,
                        tasks: tool.tasks.sort((a, b) => b.similarity - a.similarity || new Date(b.createdAt) - new Date(a.createdAt))
                    };
                })
                // Sort by weighted score (balances relevance + rating)
                .sort((a, b) => b.weightedScore - a.weightedScore)
                .slice(0, CONFIG.LIMITS.MAX_RATINGS_DISPLAY);
        }

        function performSearch(event) {
            if (event) event.preventDefault();
            
            const query = document.getElementById('searchInput').value.trim();
            
            if (query.length < CONFIG.LIMITS.MIN_SEARCH_LENGTH) {
                document.getElementById('searchResults').innerHTML = `
                    <div class="text-center py-8 text-slate-500">
                        <p>Enter at least 2 characters</p>
                    </div>
                `;
                return;
            }
            
            // Show loading skeleton
            document.getElementById('searchResults').innerHTML = `
                <div class="skeleton skeleton-card"></div>
                <div class="skeleton skeleton-card"></div>
            `;
            
            clearTimeout(AppState.searchTimeout);
            AppState.searchTimeout = setTimeout(() => {
                const results = findBestToolsForTask(query);
                displayResults(query, results);
                lucide.createIcons();
            }, CONFIG.LIMITS.SEARCH_DEBOUNCE);
        }

        function searchForTask(task) {
            document.getElementById('searchInput').value = task;
            performSearch();
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric', 
                    year: 'numeric' 
                });
            } catch (e) {
                return '';
            }
        }

        function toggleReviews(toolId) {
            const container = document.getElementById(`reviews-${toolId}`);
            const button = document.getElementById(`btn-${toolId}`);
            const icon = document.getElementById(`icon-${toolId}`);
            const text = document.getElementById(`text-${toolId}`);
            
            if (container.classList.contains('expanded')) {
                container.classList.remove('expanded');
                icon.setAttribute('data-lucide', 'chevron-down');
                text.textContent = 'View all reviews';
            } else {
                container.classList.add('expanded');
                icon.setAttribute('data-lucide', 'chevron-up');
                text.textContent = 'Show less';
            }
            lucide.createIcons();
        }

        function highlightText(text, query) {
            if (!query) return sanitizeHTML(text);
            const words = query.toLowerCase().split(/\s+/).filter(w => w.length > 2);
            let result = sanitizeHTML(text);
            words.forEach(word => {
                const regex = new RegExp(`(${word})`, 'gi');
                result = result.replace(regex, '<span class="highlight-text">$1</span>');
            });
            return result;
        }

        function generateStars(rating, filled = true) {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= rating) {
                    stars += `<i data-lucide="star" class="w-4 h-4 fill-amber-400 text-amber-400"></i>`;
                } else {
                    stars += `<i data-lucide="star" class="w-4 h-4 fill-slate-200 text-slate-200"></i>`;
                }
            }
            return stars;
        }

        function displayResults(query, results) {
            const container = document.getElementById('searchResults');
            const sanitizedQuery = sanitizeHTML(query);
            
            if (results.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8">
                        <i data-lucide="search-x" class="w-12 h-12 mx-auto mb-4 text-slate-300"></i>
                        <p class="text-slate-700">No tools found for "${sanitizedQuery}"</p>
                        <p class="text-slate-500 mt-2">Be the first to rate a tool for this task!</p>
                    </div>
                `;
                lucide.createIcons();
                return;
            }
            
            const resultsHTML = results.map((tool, index) => {
                const toolId = `tool-${index}`;
                const hasMoreReviews = tool.tasks.length > 1;
                const previewReview = tool.tasks[0];
                const additionalReviews = tool.tasks.slice(1);
                
                // Check if this tool deserves a "Best Match" badge
                // Show if: #1 ranked result AND has high relevance (>=30)
                const showBestMatch = tool.relevance >= 30 && index === 0;
                
                // Best Match badge HTML
                const bestMatchBadge = showBestMatch ? `
                    <span class="inline-flex items-center gap-1 bg-emerald-100 text-emerald-700 text-xs font-medium px-2 py-1 rounded-full ml-2">
                        <i data-lucide="target" class="w-3 h-3"></i>
                        Best Match
                    </span>
                ` : '';
                
                // Badge based on rank
                let badgeHTML = '';
                if (index === 0) {
                    badgeHTML = `
                        <div class="absolute -top-3 -right-3 bg-gradient-to-br from-amber-400 to-amber-600 text-white w-14 h-14 rounded-2xl flex items-center justify-center shadow-lg shadow-amber-200 transform rotate-12">
                            <i data-lucide="trophy" class="w-7 h-7 -rotate-12"></i>
                        </div>
                    `;
                } else if (index === 1) {
                    badgeHTML = `
                        <div class="absolute -top-3 -right-3 bg-gradient-to-br from-slate-300 to-slate-500 text-white w-14 h-14 rounded-2xl flex items-center justify-center shadow-lg shadow-slate-200 transform rotate-12">
                            <i data-lucide="medal" class="w-7 h-7 -rotate-12"></i>
                        </div>
                    `;
                } else if (index === 2) {
                    badgeHTML = `
                        <div class="absolute -top-3 -right-3 bg-gradient-to-br from-orange-400 to-orange-600 text-white w-14 h-14 rounded-2xl flex items-center justify-center shadow-lg shadow-orange-200 transform rotate-12">
                            <i data-lucide="award" class="w-7 h-7 -rotate-12"></i>
                        </div>
                    `;
                }
                
                return `
                    <div class="card-hover relative bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden mb-6">
                        ${badgeHTML}
                        
                        <div class="p-5 sm:p-6">
                            <div class="flex items-start justify-between mb-4 ${index < 3 ? 'pr-12' : ''}">
                                <div>
                                    <div class="flex items-center flex-wrap">
                                        <h3 class="text-lg sm:text-xl font-bold text-slate-800">${sanitizeHTML(tool.name)}</h3>
                                        ${bestMatchBadge}
                                    </div>
                                    <div class="flex items-center gap-2 sm:gap-3 mt-2 flex-wrap">
                                        <div class="flex gap-0.5">
                                            ${generateStars(Math.round(tool.avgRating))}
                                        </div>
                                        <span class="text-base sm:text-lg font-semibold text-slate-700">${tool.avgRating.toFixed(1)}</span>
                                        <span class="text-sm text-slate-400">(${tool.reviewCount} ${tool.reviewCount === 1 ? 'review' : 'reviews'})</span>
                                    </div>
                                </div>
                            </div>

                            <!-- First Review (always visible) -->
                            <div class="bg-slate-50 rounded-xl p-4 border-l-4 border-indigo-400">
                                <div class="flex items-start justify-between mb-2 gap-2">
                                    <p class="text-sm font-medium text-slate-700">
                                        ${highlightText(previewReview.task, query)}
                                    </p>
                                    <span class="text-xs text-slate-400 whitespace-nowrap">${formatDate(previewReview.createdAt)}</span>
                                </div>
                                <p class="text-sm text-slate-600 italic mb-2">"${sanitizeHTML(previewReview.feedback)}"</p>
                                <div class="flex items-center justify-between flex-wrap gap-2">
                                    <div class="flex gap-0.5">
                                        ${generateStars(previewReview.rating)}
                                    </div>
                                    ${previewReview.taskType ? `<span class="text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded-full">${sanitizeHTML(previewReview.taskType)}</span>` : ''}
                                </div>
                            </div>

                            <!-- Additional Reviews (expandable) -->
                            ${hasMoreReviews ? `
                                <div class="reviews-expandable space-y-3 mt-3" id="reviews-${toolId}">
                                    ${additionalReviews.map(t => `
                                        <div class="bg-slate-50 rounded-xl p-4 border-l-4 border-indigo-400">
                                            <div class="flex items-start justify-between mb-2 gap-2">
                                                <p class="text-sm font-medium text-slate-700">
                                                    ${highlightText(t.task, query)}
                                                </p>
                                                <span class="text-xs text-slate-400 whitespace-nowrap">${formatDate(t.createdAt)}</span>
                                            </div>
                                            <p class="text-sm text-slate-600 italic mb-2">"${sanitizeHTML(t.feedback)}"</p>
                                            <div class="flex items-center justify-between flex-wrap gap-2">
                                                <div class="flex gap-0.5">
                                                    ${generateStars(t.rating)}
                                                </div>
                                                ${t.taskType ? `<span class="text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded-full">${sanitizeHTML(t.taskType)}</span>` : ''}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                                <button
                                    onclick="toggleReviews('${toolId}')"
                                    id="btn-${toolId}"
                                    class="mt-4 w-full py-2 text-sm font-medium text-indigo-600 hover:text-indigo-800 flex items-center justify-center gap-1 transition-colors rounded-lg hover:bg-indigo-50"
                                >
                                    <i data-lucide="chevron-down" class="w-4 h-4" id="icon-${toolId}"></i>
                                    <span id="text-${toolId}">View all ${tool.tasks.length} reviews</span>
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = `
                <h2 class="text-xl sm:text-2xl font-bold text-slate-800 mb-6">
                    Results for "<span class="text-indigo-600">${sanitizedQuery}</span>"
                </h2>
                ${resultsHTML}
            `;
            
            lucide.createIcons();
        }

        // ====================================
        // RATING SUBMISSION
        // ====================================
        
        async function submitRating(event) {
            event.preventDefault();
            
            if (!canSubmit()) {
                showError('Please wait before submitting again');
                return;
            }
            
            const toolName = document.getElementById('toolName').value.trim();
            const taskDescription = document.getElementById('taskDescription').value.trim();
            const userFeedback = document.getElementById('userFeedback').value.trim();
            const toolPrice = document.getElementById('toolPrice').value;
            
            if (!validateInput(toolName, CONFIG.LIMITS.MAX_TOOL_NAME)) {
                showError('Tool name is invalid or too long');
                return;
            }
            
            if (!validateInput(taskDescription, CONFIG.LIMITS.MAX_TASK_DESC)) {
                showError('Task description is required');
                return;
            }
            
            if (!validateInput(userFeedback, CONFIG.LIMITS.MAX_FEEDBACK)) {
                showError('Feedback is required');
                return;
            }
            
            if (!validateRating(AppState.selectedRating)) {
                showError('Please select a star rating');
                return;
            }
            
            if (!AppState.captchaVerified) {
                document.getElementById('captchaError').classList.remove('hidden');
                showError('Please complete the CAPTCHA');
                return;
            }
            
            AppState.isSubmitting = true;
            AppState.lastSubmitTime = Date.now();
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            document.getElementById('submitBtnText').textContent = 'Saving...';
            
            try {
                const formData = {
                    toolName: sanitizeHTML(toolName),
                    task: sanitizeHTML(taskDescription.toLowerCase()),
                    taskType: AppState.selectedTaskType || null,
                    feedback: sanitizeHTML(userFeedback),
                    rating: AppState.selectedRating,
                    price: toolPrice || 'Not specified',
                    createdAt: new Date().toISOString(),
                    timestamp: Date.now()
                };
                
                let submitted = false;
                if (AppState.isConnected && AppState.db) {
                    try {
                        const docRef = await AppState.db.collection('ratings').add(formData);
                        formData.id = docRef.id;
                        submitted = true;
                    } catch (err) {
                        console.error('Firebase error:', err);
                    }
                }
                
                if (!submitted) {
                    formData.id = 'local_' + Date.now();
                }
                
                AppState.allRatings.unshift(formData);
                saveLocalRatings();
                updateStats();
                
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'tool_ranking_submitted', {
                        tool_name: sanitizeHTML(toolName),
                        task_type: AppState.selectedTaskType || 'not_specified',
                        rating: AppState.selectedRating
                    });
                }
                
                showSuccess(submitted ? 'Rating submitted!' : 'Saved locally');
                
                // Reset form
                document.getElementById('ratingForm').reset();
                AppState.selectedRating = 0;
                AppState.selectedTaskType = null;
                AppState.captchaVerified = false;
                updateStars();
                clearTaskType();
                updateCharCounter('taskDescription');
                updateCharCounter('userFeedback');
                
                if (typeof grecaptcha !== 'undefined') {
                    grecaptcha.reset();
                }
                
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
            } catch (error) {
                showError('Failed to submit');
            } finally {
                AppState.isSubmitting = false;
                submitBtn.disabled = false;
                document.getElementById('submitBtnText').textContent = 'Submit Rating';
            }
        }

        // ====================================
        // UI FUNCTIONS
        // ====================================
        
        function updateConnectionStatus(status) {
            // Connection status banner removed - function kept for compatibility
            console.log('Connection status:', status);
        }

        function showSuccess(message) {
            const el = document.getElementById('successMessage');
            document.getElementById('successText').textContent = message;
            el.classList.add('show');
            setTimeout(() => el.classList.remove('show'), 4000);
        }

        function showError(message) {
            const el = document.getElementById('errorMessage');
            document.getElementById('errorText').textContent = message;
            el.classList.add('show');
            setTimeout(() => el.classList.remove('show'), 4000);
        }

        function updateStats() {
            const tools = new Set();
            const tasks = new Set();
            let totalRating = 0;
            let count = 0;
            
            AppState.allRatings.forEach(r => {
                tools.add(normalizeToolName(r.toolName));
                tasks.add(r.task?.toLowerCase());
                totalRating += r.rating || 0;
                count++;
            });
            
            document.getElementById('toolCount').textContent = tools.size;
            document.getElementById('taskCount').textContent = tasks.size;
            document.getElementById('ratingCount').textContent = AppState.allRatings.length;
            document.getElementById('avgRating').textContent = count ? (totalRating / count).toFixed(1) : '0.0';
        }

        function updateCharCounter(fieldId) {
            const field = document.getElementById(fieldId);
            const counter = document.getElementById(fieldId === 'taskDescription' ? 'taskCounter' : 'feedbackCounter');
            
            if (!field || !counter) return;
            
            const length = field.value.length;
            const max = fieldId === 'taskDescription' ? CONFIG.LIMITS.MAX_TASK_DESC : CONFIG.LIMITS.MAX_FEEDBACK;
            
            counter.textContent = `${length}/${max}`;
            counter.className = 'text-right text-xs mt-1';
            
            if (length >= max) {
                counter.classList.add('text-red-500');
            } else if (length >= max * 0.9) {
                counter.classList.add('text-amber-500');
            } else {
                counter.classList.add('text-slate-400');
            }
        }

        function updateStars() {
            document.querySelectorAll('.star-btn').forEach((btn, index) => {
                const icon = btn.querySelector('.star-icon');
                const isActive = index < AppState.selectedRating;
                
                if (isActive) {
                    icon.classList.remove('fill-slate-200', 'text-slate-300');
                    icon.classList.add('fill-amber-400', 'text-amber-400');
                } else {
                    icon.classList.remove('fill-amber-400', 'text-amber-400');
                    icon.classList.add('fill-slate-200', 'text-slate-300');
                }
            });
        }

        function selectTaskType(type) {
            document.querySelectorAll('.task-chip').forEach(chip => {
                chip.classList.remove('chip-selected');
            });
            
            const selectedChip = document.querySelector(`.task-chip[data-type="${type}"]`);
            if (selectedChip) {
                selectedChip.classList.add('chip-selected');
            }
            
            AppState.selectedTaskType = type;
        }

        function clearTaskType() {
            document.querySelectorAll('.task-chip').forEach(chip => {
                chip.classList.remove('chip-selected');
            });
            AppState.selectedTaskType = null;
        }

        // ====================================
        // EVENT LISTENERS
        // ====================================
        
        function setupEventListeners() {
            // Search
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', () => {
                clearTimeout(AppState.searchTimeout);
                if (searchInput.value.length >= CONFIG.LIMITS.MIN_SEARCH_LENGTH) {
                    AppState.searchTimeout = setTimeout(performSearch, CONFIG.LIMITS.SEARCH_DEBOUNCE);
                }
            });
            
            // Form
            document.getElementById('ratingForm').addEventListener('submit', submitRating);
            
            // Character counters
            document.getElementById('taskDescription').addEventListener('input', () => updateCharCounter('taskDescription'));
            document.getElementById('userFeedback').addEventListener('input', () => updateCharCounter('userFeedback'));
            
            // Task Type chips
            document.querySelectorAll('.task-chip').forEach(chip => {
                chip.addEventListener('click', function() {
                    const type = this.dataset.type;
                    if (AppState.selectedTaskType === type) {
                        clearTaskType();
                    } else {
                        selectTaskType(type);
                    }
                });
            });
            
            // Star rating
            document.querySelectorAll('.star-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    AppState.selectedRating = parseInt(this.dataset.rating);
                    updateStars();
                });
                
                btn.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    AppState.selectedRating = parseInt(this.dataset.rating);
                    updateStars();
                    if (window.navigator.vibrate) {
                        window.navigator.vibrate(10);
                    }
                });
            });
        }

        // ====================================
        // INITIALIZATION
        // ====================================
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
        
        window.addEventListener('beforeunload', saveLocalRatings);
    </script>
</body>
</html>
