<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-X2W323M13Z"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-X2W323M13Z');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <meta name="description" content="Find the best AI tools for specific tasks based on real user reviews">
    <meta name="theme-color" content="#4f46e5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>AI Tools Rank - Find the Best AI Tool for Your Task</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <!-- DOMPurify for XSS prevention -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Plus Jakarta Sans', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes pulse-glow {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }
        
        .float-animation {
            animation: float 6s ease-in-out infinite;
        }
        
        .glow-animation {
            animation: pulse-glow 3s ease-in-out infinite;
        }
        
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px -12px rgba(99, 102, 241, 0.15);
        }
        
        .btn-press:active {
            transform: scale(0.97);
        }
        
        .star-hover:hover {
            transform: scale(1.15);
        }
        
        .chip-selected {
            background: linear-gradient(135deg, #4f46e5, #7c3aed) !important;
            color: white !important;
            border-color: transparent !important;
            box-shadow: 0 4px 14px -3px rgba(99, 102, 241, 0.4);
        }
        
        .glassmorphism {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }
        
        @keyframes pulse-subtle {
            0%, 100% { box-shadow: 0 10px 25px -5px rgba(99, 102, 241, 0.4); }
            50% { box-shadow: 0 15px 35px -5px rgba(99, 102, 241, 0.6); }
        }
        
        .animate-pulse-subtle {
            animation: pulse-subtle 2s ease-in-out infinite;
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .highlight-text {
            background: #fef08a;
            padding: 0 4px;
            border-radius: 4px;
        }
        
        /* Reviews expandable */
        .reviews-expandable {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        
        .reviews-expandable.expanded {
            max-height: 2000px;
            transition: max-height 0.5s ease-in;
        }
        
        /* Messages */
        .message {
            display: none;
            animation: slideIn 0.3s ease-out;
        }
        
        .message.show {
            display: flex;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Skeleton loading */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: 16px;
        }
        
        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        .skeleton-card {
            height: 180px;
            margin-bottom: 1rem;
        }
        
        /* Mobile adjustments */
        @media (max-width: 640px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr) !important;
            }
            .stats-divider:nth-child(2)::after {
                display: none;
            }
        }
    </style>
</head>
<body class="min-h-screen bg-slate-50">
    <!-- Pull to Refresh Indicator -->
    <div id="pullIndicator" class="fixed top-16 left-1/2 -translate-x-1/2 -translate-y-full bg-white px-4 py-2 rounded-full shadow-lg text-sm text-slate-600 opacity-0 transition-all duration-300 z-50">
        <span id="pullText">‚Üì Pull to refresh</span>
    </div>
    
    <style>
        #pullIndicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        #pullIndicator.refreshing {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
        }
    </style>

    <!-- Decorative Background -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="absolute top-0 left-1/4 w-96 h-96 bg-indigo-200/30 rounded-full blur-3xl glow-animation"></div>
        <div class="absolute top-1/3 right-1/4 w-80 h-80 bg-violet-200/30 rounded-full blur-3xl glow-animation" style="animation-delay: 1s;"></div>
        <div class="absolute bottom-1/4 left-1/3 w-72 h-72 bg-pink-200/20 rounded-full blur-3xl glow-animation" style="animation-delay: 2s;"></div>
    </div>

    <!-- Header -->
    <header class="relative border-b border-slate-200/50 bg-white/80 backdrop-blur-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 py-4 flex items-center">
            <a href="#" onclick="location.reload(); return false;" class="flex items-center gap-3">
                <div class="bg-gradient-to-br from-indigo-600 to-violet-600 p-2.5 rounded-xl shadow-lg shadow-indigo-200">
                    <i data-lucide="bar-chart-3" class="w-5 h-5 sm:w-6 sm:h-6 text-white"></i>
                </div>
                <span class="text-lg sm:text-xl font-bold text-slate-800">AI Tools Rank</span>
            </a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="relative max-w-7xl mx-auto px-4 sm:px-6 py-8 sm:py-12">
        
        <!-- Hero Section -->
        <div class="text-center mb-10 sm:mb-12">
            <!-- Badge -->
            <div class="inline-flex items-center gap-2 bg-indigo-100 text-indigo-700 px-4 py-2 rounded-full text-sm font-medium mb-6">
                <i data-lucide="sparkles" class="w-4 h-4"></i>
                Crowd-sourced AI Tool Rankings
            </div>
            
            <!-- Title -->
            <h1 class="text-3xl sm:text-5xl md:text-6xl font-extrabold text-slate-800 mb-4 tracking-tight">
                Find the <span class="gradient-text">Best AI Tool</span>
                <br class="hidden sm:block">for Your Task
            </h1>
            
            <!-- Subtitle -->
            <p class="text-lg sm:text-xl text-slate-500 max-w-2xl mx-auto mb-6 sm:mb-8 px-4">
                Real reviews from real users. Discover which AI tools actually deliver results.
            </p>

            <!-- Search Bar - Moved Up for Immediate Utility -->
            <div class="relative max-w-2xl mx-auto mb-8 sm:mb-10 px-4">
                <form onsubmit="performSearch(event); return false;" class="relative">
                    <i data-lucide="search" class="absolute left-4 sm:left-5 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"></i>
                    <input
                        type="text"
                        id="searchInput"
                        placeholder="What task do you need help with?"
                        maxlength="200"
                        autocomplete="off"
                        class="w-full pl-12 sm:pl-14 pr-24 sm:pr-32 py-4 sm:py-5 rounded-xl sm:rounded-2xl border border-slate-200 shadow-lg focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition-all outline-none text-slate-800 placeholder:text-slate-400 text-base sm:text-lg bg-white"
                    >
                    <button
                        type="submit"
                        id="searchBtn"
                        class="absolute right-2 sm:right-3 top-1/2 -translate-y-1/2 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-4 sm:px-6 py-2.5 sm:py-3 rounded-lg sm:rounded-xl transition-all duration-200 btn-press shadow-md shadow-indigo-200"
                    >
                        Search
                    </button>
                </form>
                <p class="text-sm text-slate-400 mt-2 text-center">Try "write marketing copy" or "generate images"</p>
            </div>
        </div>

        <!-- Search Results -->
        <div id="resultsSection" class="mb-12 sm:mb-16 px-4">
            <div id="searchResults">
                <!-- Results will appear here after search -->
            </div>
        </div>

        <!-- Rate a Tool Form - 3-Step Progressive Disclosure -->
        <div class="max-w-2xl mx-auto px-4">
            <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                <!-- Header with Progress -->
                <div class="bg-gradient-to-r from-indigo-600 to-violet-600 px-5 sm:px-6 py-5">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="bg-white/20 p-2.5 rounded-xl">
                                <i data-lucide="sparkles" class="w-5 h-5 sm:w-6 sm:h-6 text-white"></i>
                            </div>
                            <div>
                                <h2 class="text-lg sm:text-xl font-bold text-white">Rate an AI Tool</h2>
                                <p class="text-indigo-100 text-sm">Share your experience and help others</p>
                            </div>
                        </div>
                        <!-- Step Counter -->
                        <div class="text-white/90 text-sm font-medium bg-white/20 px-3 py-1.5 rounded-full" id="stepCounter">
                            Step 1 of 3
                        </div>
                    </div>
                    <!-- Progress Bar -->
                    <div class="mt-4 h-1.5 bg-white/20 rounded-full overflow-hidden">
                        <div id="progressBar" class="h-full bg-white rounded-full transition-all duration-500 ease-out" style="width: 33.33%"></div>
                    </div>
                </div>

                <!-- Form -->
                <form id="ratingForm" class="p-5 sm:p-6" novalidate>
                    <!-- Messages -->
                    <div class="message items-center gap-2 p-4 rounded-xl bg-emerald-50 text-emerald-700 border border-emerald-200 mb-5" id="successMessage">
                        <i data-lucide="check-circle" class="w-5 h-5"></i>
                        <span id="successText">Rating saved!</span>
                    </div>
                    
                    <div class="message items-center gap-2 p-4 rounded-xl bg-red-50 text-red-700 border border-red-200 mb-5" id="errorMessage">
                        <i data-lucide="alert-circle" class="w-5 h-5"></i>
                        <span id="errorText">Something went wrong</span>
                    </div>

                    <!-- ========== STEP 1: The Hook ========== -->
                    <div id="formStep1" class="form-step">
                        <div class="text-center mb-6">
                            <div class="inline-flex items-center justify-center w-16 h-16 bg-indigo-100 rounded-2xl mb-4">
                                <i data-lucide="search" class="w-8 h-8 text-indigo-600"></i>
                            </div>
                            <h3 class="text-xl font-bold text-slate-800 mb-2">Which AI tool did you use?</h3>
                            <p class="text-slate-500">Start by telling us the name of the tool</p>
                        </div>
                        
                        <div class="mb-6 relative">
                            <input
                                type="text"
                                id="toolName"
                                required
                                maxlength="50"
                                autocomplete="off"
                                placeholder="e.g., ChatGPT, Midjourney, Claude..."
                                class="w-full px-5 py-4 rounded-xl border-2 border-slate-200 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition-all outline-none text-slate-800 placeholder:text-slate-400 text-lg text-center"
                            >
                            <!-- Autocomplete Dropdown -->
                            <div id="toolSuggestions" class="absolute left-0 right-0 top-full mt-2 bg-white rounded-xl shadow-xl border border-slate-200 overflow-hidden z-50 hidden max-h-64 overflow-y-auto">
                                <!-- Suggestions will be inserted here -->
                            </div>
                        </div>
                        
                        <button
                            type="button"
                            onclick="goToStep(2)"
                            id="step1NextBtn"
                            class="w-full bg-gradient-to-r from-indigo-600 to-violet-600 hover:from-indigo-700 hover:to-violet-700 text-white font-semibold py-4 px-6 rounded-xl shadow-lg shadow-indigo-200 transform transition-all duration-200 hover:shadow-xl hover:-translate-y-0.5 btn-press disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none disabled:shadow-none"
                            disabled
                        >
                            Next ‚Üí
                        </button>
                    </div>

                    <!-- ========== STEP 2: The Opinion ========== -->
                    <div id="formStep2" class="form-step hidden">
                        <div class="text-center mb-6">
                            <div class="inline-flex items-center justify-center w-16 h-16 bg-amber-100 rounded-2xl mb-4">
                                <i data-lucide="star" class="w-8 h-8 text-amber-500"></i>
                            </div>
                            <h3 class="text-xl font-bold text-slate-800 mb-2">How would you rate it?</h3>
                            <p class="text-slate-500">Select your rating and what you used it for</p>
                        </div>
                        
                        <!-- Star Rating -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-slate-700 mb-3 text-center">
                                Your Rating <span class="text-rose-500">*</span>
                            </label>
                            <div class="flex justify-center gap-1 sm:gap-2" id="starRating">
                                <button type="button" data-rating="1" class="star-btn transition-all duration-200 p-1.5 sm:p-2 rounded-xl hover:bg-amber-50 active:bg-amber-100">
                                    <i data-lucide="star" class="w-8 h-8 sm:w-10 sm:h-10 fill-slate-200 text-slate-300 star-icon transition-all"></i>
                                </button>
                                <button type="button" data-rating="2" class="star-btn transition-all duration-200 p-1.5 sm:p-2 rounded-xl hover:bg-amber-50 active:bg-amber-100">
                                    <i data-lucide="star" class="w-8 h-8 sm:w-10 sm:h-10 fill-slate-200 text-slate-300 star-icon transition-all"></i>
                                </button>
                                <button type="button" data-rating="3" class="star-btn transition-all duration-200 p-1.5 sm:p-2 rounded-xl hover:bg-amber-50 active:bg-amber-100">
                                    <i data-lucide="star" class="w-8 h-8 sm:w-10 sm:h-10 fill-slate-200 text-slate-300 star-icon transition-all"></i>
                                </button>
                                <button type="button" data-rating="4" class="star-btn transition-all duration-200 p-1.5 sm:p-2 rounded-xl hover:bg-amber-50 active:bg-amber-100">
                                    <i data-lucide="star" class="w-8 h-8 sm:w-10 sm:h-10 fill-slate-200 text-slate-300 star-icon transition-all"></i>
                                </button>
                                <button type="button" data-rating="5" class="star-btn transition-all duration-200 p-1.5 sm:p-2 rounded-xl hover:bg-amber-50 active:bg-amber-100">
                                    <i data-lucide="star" class="w-8 h-8 sm:w-10 sm:h-10 fill-slate-200 text-slate-300 star-icon transition-all"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Task Type Chips -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-slate-700 mb-3 text-center">
                                What type of task? <span class="text-rose-500">*</span>
                            </label>
                            <div class="flex flex-wrap justify-center gap-2 max-h-48 overflow-y-auto px-1" id="taskTypeChips">
                                <button type="button" data-type="Writing" class="task-chip px-3 sm:px-4 py-2 sm:py-2.5 rounded-full text-xs sm:text-sm font-medium bg-white text-slate-600 border-2 border-slate-200 hover:border-indigo-400 hover:bg-indigo-50 active:bg-indigo-100 transition-all btn-press">‚úçÔ∏è Writing</button>
                                <button type="button" data-type="Image generation" class="task-chip px-3 sm:px-4 py-2 sm:py-2.5 rounded-full text-xs sm:text-sm font-medium bg-white text-slate-600 border-2 border-slate-200 hover:border-indigo-400 hover:bg-indigo-50 active:bg-indigo-100 transition-all btn-press">üé® Image Gen</button>
                                <button type="button" data-type="Data analysis" class="task-chip px-3 sm:px-4 py-2 sm:py-2.5 rounded-full text-xs sm:text-sm font-medium bg-white text-slate-600 border-2 border-slate-200 hover:border-indigo-400 hover:bg-indigo-50 active:bg-indigo-100 transition-all btn-press">üìä Data</button>
                                <button type="button" data-type="Coding" class="task-chip px-3 sm:px-4 py-2 sm:py-2.5 rounded-full text-xs sm:text-sm font-medium bg-white text-slate-600 border-2 border-slate-200 hover:border-indigo-400 hover:bg-indigo-50 active:bg-indigo-100 transition-all btn-press">üíª Coding</button>
                                <button type="button" data-type="Research" class="task-chip px-3 sm:px-4 py-2 sm:py-2.5 rounded-full text-xs sm:text-sm font-medium bg-white text-slate-600 border-2 border-slate-200 hover:border-indigo-400 hover:bg-indigo-50 active:bg-indigo-100 transition-all btn-press">üî¨ Research</button>
                                <button type="button" data-type="Marketing" class="task-chip px-3 sm:px-4 py-2 sm:py-2.5 rounded-full text-xs sm:text-sm font-medium bg-white text-slate-600 border-2 border-slate-200 hover:border-indigo-400 hover:bg-indigo-50 active:bg-indigo-100 transition-all btn-press">üì¢ Marketing</button>
                                <button type="button" data-type="Design" class="task-chip px-3 sm:px-4 py-2 sm:py-2.5 rounded-full text-xs sm:text-sm font-medium bg-white text-slate-600 border-2 border-slate-200 hover:border-indigo-400 hover:bg-indigo-50 active:bg-indigo-100 transition-all btn-press">üéØ Design</button>
                                <button type="button" data-type="Audio/Video" class="task-chip px-3 sm:px-4 py-2 sm:py-2.5 rounded-full text-xs sm:text-sm font-medium bg-white text-slate-600 border-2 border-slate-200 hover:border-indigo-400 hover:bg-indigo-50 active:bg-indigo-100 transition-all btn-press">üé¨ Audio/Video</button>
                                <button type="button" data-type="Other" class="task-chip px-3 sm:px-4 py-2 sm:py-2.5 rounded-full text-xs sm:text-sm font-medium bg-white text-slate-600 border-2 border-slate-200 hover:border-indigo-400 hover:bg-indigo-50 active:bg-indigo-100 transition-all btn-press">üìÅ Other</button>
                            </div>
                        </div>
                        
                        <div class="flex gap-2 sm:gap-3">
                            <button
                                type="button"
                                onclick="goToStep(1)"
                                class="flex-1 bg-slate-100 hover:bg-slate-200 active:bg-slate-300 text-slate-700 font-semibold py-3.5 sm:py-4 px-4 sm:px-6 rounded-xl transition-all duration-200 btn-press text-sm sm:text-base"
                            >
                                ‚Üê Back
                            </button>
                            <button
                                type="button"
                                onclick="goToStep(3)"
                                id="step2NextBtn"
                                class="flex-[2] bg-gradient-to-r from-indigo-600 to-violet-600 hover:from-indigo-700 hover:to-violet-700 text-white font-semibold py-3.5 sm:py-4 px-4 sm:px-6 rounded-xl shadow-lg shadow-indigo-200 transform transition-all duration-200 hover:shadow-xl hover:-translate-y-0.5 btn-press disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none disabled:shadow-none text-sm sm:text-base"
                                disabled
                            >
                                Next ‚Üí
                            </button>
                        </div>
                    </div>

                    <!-- ========== STEP 3: The Context ========== -->
                    <div id="formStep3" class="form-step hidden">
                        <div class="text-center mb-6">
                            <div class="inline-flex items-center justify-center w-16 h-16 bg-emerald-100 rounded-2xl mb-4">
                                <i data-lucide="message-square" class="w-8 h-8 text-emerald-600"></i>
                            </div>
                            <h3 class="text-xl font-bold text-slate-800 mb-2">Tell us more!</h3>
                            <p class="text-slate-500">Help others with the details</p>
                        </div>
                        
                        <!-- Task Description -->
                        <div class="mb-5">
                            <label class="block text-sm font-medium text-slate-700 mb-2">
                                What did you use it for? <span class="text-rose-500">*</span>
                            </label>
                            <textarea
                                id="taskDescription"
                                required
                                maxlength="200"
                                placeholder="e.g., Writing a blog post about AI trends..."
                                rows="2"
                                class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition-all outline-none text-slate-800 placeholder:text-slate-400 resize-none"
                            ></textarea>
                            <div class="text-right text-xs text-slate-400 mt-1" id="taskCounter">0/200</div>
                        </div>

                        <!-- Feedback -->
                        <div class="mb-5">
                            <label class="block text-sm font-medium text-slate-700 mb-2">
                                Your Feedback <span class="text-rose-500">*</span>
                            </label>
                            <textarea
                                id="userFeedback"
                                required
                                maxlength="500"
                                placeholder="What worked well? What could be better?"
                                rows="3"
                                class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition-all outline-none text-slate-800 placeholder:text-slate-400 resize-none"
                            ></textarea>
                            <div class="text-right text-xs text-slate-400 mt-1" id="feedbackCounter">0/500</div>
                        </div>

                        <!-- Your Name (Optional) -->
                        <div class="mb-5">
                            <label class="block text-sm font-medium text-slate-700 mb-2">
                                Your Name <span class="text-slate-400">(optional)</span>
                            </label>
                            <input
                                type="text"
                                id="reviewerName"
                                maxlength="50"
                                placeholder="How should we credit you?"
                                class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition-all outline-none text-slate-800 placeholder:text-slate-400"
                            >
                        </div>
                        
                        <div class="flex gap-3">
                            <button
                                type="button"
                                onclick="goToStep(2)"
                                class="flex-1 bg-slate-100 hover:bg-slate-200 text-slate-700 font-semibold py-4 px-6 rounded-xl transition-all duration-200 btn-press"
                            >
                                ‚Üê Back
                            </button>
                            <button
                                type="submit"
                                id="submitBtn"
                                class="flex-[2] bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 text-white font-semibold py-4 px-6 rounded-xl shadow-lg shadow-emerald-200 transform transition-all duration-200 hover:shadow-xl hover:-translate-y-0.5 btn-press focus:outline-none focus:ring-4 focus:ring-emerald-100"
                            >
                                <span id="submitBtnText">Submit Rating ‚úì</span>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="relative border-t border-slate-200 bg-white/80 backdrop-blur-lg mt-16">
        <div class="max-w-7xl mx-auto px-6 py-8 text-center">
            <p class="text-slate-500 mb-4">AI Tools Rank ‚Äî Helping you find the best AI tools for your tasks</p>
            <a 
                href="https://www.linkedin.com/in/ron-lev-1269137a/" 
                target="_blank" 
                rel="noopener noreferrer"
                class="inline-flex items-center gap-2 text-indigo-600 hover:text-indigo-800 font-semibold transition-colors"
            >
                Built by Ron Lev üîó
            </a>
        </div>
    </footer>

    <script>
        'use strict';

        // Initialize Lucide icons
        lucide.createIcons();

        // ====================================
        // CONFIGURATION
        // ====================================
        
        const CONFIG = Object.freeze({
            FIREBASE: {
                apiKey: "AIzaSyBfEWQo79qbO10AMwsmaODqu7u_C_m2HGg",
                authDomain: "ai-tools-rank.firebaseapp.com",
                projectId: "ai-tools-rank",
                storageBucket: "ai-tools-rank.firebasestorage.app",
                messagingSenderId: "332988419959",
                appId: "1:332988419959:web:3d4eb8552f3205fcb79b72"
            },
            LIMITS: {
                MAX_LOCAL_STORAGE: 1000000,
                MAX_RATINGS_DISPLAY: 50,
                MAX_RATINGS_STORE: 500,
                SEARCH_DEBOUNCE: 300,
                SUBMIT_COOLDOWN: 2000,
                MIN_SEARCH_LENGTH: 2,
                MAX_SEARCH_LENGTH: 200,
                MAX_TOOL_NAME: 50,
                MAX_TASK_DESC: 200,
                MAX_FEEDBACK: 500
            }
        });

        // Global state
        const AppState = {
            db: null,
            isConnected: false,
            selectedRating: 0,
            selectedTaskType: null,
            allRatings: [],
            isSubmitting: false,
            searchTimeout: null,
            lastSubmitTime: 0,
            isMobile: /iPhone|iPad|iPod|Android/i.test(navigator.userAgent),
            isLoading: true,
            isPulling: false,
            currentStep: 1
        };

        // ====================================
        // SECURITY FUNCTIONS
        // ====================================
        
        function sanitizeHTML(str) {
            if (!str) return '';
            if (typeof DOMPurify !== 'undefined') {
                return DOMPurify.sanitize(str, { ALLOWED_TAGS: [] });
            }
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function validateInput(value, maxLength) {
            if (!value || typeof value !== 'string') return false;
            if (value.length > maxLength) return false;
            return true;
        }

        function validateRating(rating) {
            return Number.isInteger(rating) && rating >= 1 && rating <= 5;
        }

        function canSubmit() {
            const now = Date.now();
            const timeSinceLastSubmit = now - AppState.lastSubmitTime;
            return !AppState.isSubmitting && timeSinceLastSubmit > CONFIG.LIMITS.SUBMIT_COOLDOWN;
        }

        // ====================================
        // INITIALIZATION
        // ====================================
        
        function initializeApp() {
            console.log('Initializing app...');
            
            // Mobile viewport height handling
            updateViewportHeight();
            window.addEventListener('resize', updateViewportHeight);
            window.addEventListener('orientationchange', () => {
                setTimeout(updateViewportHeight, 100);
            });
            
            // Mobile-specific adjustments
            if (AppState.isMobile) {
                document.body.classList.add('mobile');
                setupPullToRefresh();
                setupKeyboardHandling();
            }
            
            if (typeof firebase !== 'undefined') {
                initializeFirebase();
            } else {
                loadFirebaseFallback();
            }
            
            setupEventListeners();
            updateCharCounter('taskDescription');
            updateCharCounter('userFeedback');
        }

        // Viewport height calculation for mobile
        function updateViewportHeight() {
            const vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        }

        // Pull to refresh for mobile
        function setupPullToRefresh() {
            let startY = 0;
            let currentY = 0;
            const pullIndicator = document.getElementById('pullIndicator');
            const pullText = document.getElementById('pullText');
            
            if (!pullIndicator) return;
            
            document.addEventListener('touchstart', (e) => {
                if (window.scrollY === 0) {
                    startY = e.touches[0].pageY;
                    AppState.isPulling = true;
                }
            }, { passive: true });
            
            document.addEventListener('touchmove', (e) => {
                if (!AppState.isPulling || window.scrollY > 0) return;
                
                currentY = e.touches[0].pageY;
                const pullDistance = currentY - startY;
                
                if (pullDistance > 0 && pullDistance < 150) {
                    pullIndicator.classList.add('visible');
                    
                    if (pullDistance > 80) {
                        pullText.textContent = '‚Üë Release to refresh';
                    } else {
                        pullText.textContent = '‚Üì Pull to refresh';
                    }
                }
            }, { passive: true });
            
            document.addEventListener('touchend', () => {
                const pullDistance = currentY - startY;
                
                if (AppState.isPulling && pullDistance > 80 && window.scrollY === 0) {
                    pullIndicator.classList.add('refreshing');
                    pullText.textContent = '‚ü≥ Refreshing...';
                    
                    setTimeout(() => {
                        location.reload();
                    }, 500);
                } else {
                    pullIndicator.classList.remove('visible');
                }
                
                AppState.isPulling = false;
                startY = 0;
                currentY = 0;
            }, { passive: true });
        }

        // Keyboard handling for mobile
        function setupKeyboardHandling() {
            const inputs = document.querySelectorAll('input, textarea, select');
            
            inputs.forEach(input => {
                input.addEventListener('focus', () => {
                    setTimeout(() => {
                        input.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 300);
                });
            });

            if (window.visualViewport) {
                window.visualViewport.addEventListener('resize', () => {
                    const activeEl = document.activeElement;
                    if (activeEl && (activeEl.tagName === 'INPUT' || activeEl.tagName === 'TEXTAREA')) {
                        activeEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                });
            }
        }

        function initializeFirebase() {
            try {
                firebase.initializeApp(CONFIG.FIREBASE);
                AppState.db = firebase.firestore();
                
                AppState.db.enablePersistence({ synchronizeTabs: true })
                    .catch(err => console.warn('Persistence failed:', err));
                
                AppState.db.collection('ratings').limit(1).get()
                    .then(() => {
                        AppState.isConnected = true;
                        updateConnectionStatus('connected');
                        loadRatings();
                    })
                    .catch(error => {
                        if (error.code === 'permission-denied') {
                            AppState.isConnected = true;
                            updateConnectionStatus('write-only');
                        } else {
                            updateConnectionStatus('offline');
                        }
                        loadLocalRatings();
                    });
            } catch (error) {
                console.error('Firebase error:', error);
                initializeOfflineMode();
            }
        }

        function loadFirebaseFallback() {
            initializeOfflineMode();
        }

        function initializeOfflineMode() {
            AppState.isConnected = false;
            updateConnectionStatus('offline');
            loadLocalRatings();
        }

        // ====================================
        // DATA MANAGEMENT
        // ====================================
        
        async function loadRatings() {
            AppState.isLoading = true;
            
            try {
                const snapshot = await AppState.db.collection('ratings')
                    .orderBy('createdAt', 'desc')
                    .limit(CONFIG.LIMITS.MAX_RATINGS_STORE)
                    .get();
                
                AppState.allRatings = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                updateStats();
            } catch (error) {
                console.error('Error loading:', error);
                loadLocalRatings();
            } finally {
                AppState.isLoading = false;
            }
        }

        function loadLocalRatings() {
            AppState.isLoading = true;
            
            try {
                const stored = localStorage.getItem('aiToolRatings');
                if (stored) {
                    AppState.allRatings = JSON.parse(stored);
                } else {
                    AppState.allRatings = [
                        { id: 'demo1', toolName: 'ChatGPT', task: 'write marketing copy', feedback: 'Great for content', rating: 5, price: 'Free' },
                        { id: 'demo2', toolName: 'Claude', task: 'analyze data', feedback: 'Excellent analysis', rating: 5, price: '$20/month' },
                        { id: 'demo3', toolName: 'Midjourney', task: 'generate images', feedback: 'Amazing quality', rating: 5, price: '$10/month' }
                    ];
                }
                updateStats();
            } catch (error) {
                console.error('Local storage error:', error);
            } finally {
                AppState.isLoading = false;
            }
        }

        function saveLocalRatings() {
            try {
                const data = JSON.stringify(AppState.allRatings.slice(0, CONFIG.LIMITS.MAX_RATINGS_STORE));
                if (data.length < CONFIG.LIMITS.MAX_LOCAL_STORAGE) {
                    localStorage.setItem('aiToolRatings', data);
                }
            } catch (error) {
                console.error('Save error:', error);
            }
        }

        // ====================================
        // SEARCH
        // ====================================
        
        function normalizeToolName(name) {
            return name.toLowerCase().replace(/[^a-z0-9]/g, '');
        }

        // Synonym mapping for better search results
        // Maps search terms to related terms (more precise matching)
        const synonymMap = {
            // Image-related
            'photo': ['image', 'picture', 'visual'],
            'picture': ['image', 'photo', 'visual'],
            'image': ['photo', 'picture', 'visual', 'graphic'],
            'visual': ['image', 'graphic'],
            'illustration': ['image', 'graphic', 'art'],
            
            // Code-related
            'coding': ['code', 'programming', 'developer'],
            'programming': ['code', 'coding', 'developer'],
            'code': ['coding', 'programming'],
            'debug': ['debugging', 'code', 'fix'],
            'debugging': ['debug', 'code', 'fix'],
            
            // Writing sub-types (more granular)
            'blog': ['article', 'post'],
            'article': ['blog', 'post'],
            'post': ['blog', 'article'],
            'email': ['message', 'draft'],
            'copy': ['copywriting', 'advertising'],
            'copywriting': ['copy', 'advertising', 'marketing'],
            
            // Data-related
            'data': ['analysis', 'analytics', 'csv'],
            'analytics': ['analysis', 'data'],
            'analysis': ['analytics', 'data', 'analyze'],
            'analyze': ['analyse', 'analysis'],
            'analyse': ['analyze', 'analysis'],
            'spreadsheet': ['csv', 'excel', 'data'],
            'csv': ['spreadsheet', 'data', 'excel'],
            
            // Research-related
            'research': ['investigate', 'find', 'lookup'],
            'investigate': ['research', 'find'],
            
            // Marketing-related
            'marketing': ['advertising', 'campaign', 'promotion'],
            'advertise': ['advertising', 'marketing', 'ads'],
            'advertising': ['marketing', 'ads', 'campaign'],
            'campaign': ['marketing', 'advertising'],
            'ads': ['advertising', 'marketing'],
            
            // Generation-related
            'generate': ['create', 'make', 'produce'],
            'create': ['generate', 'make', 'build'],
            'make': ['create', 'generate', 'build']
        };

        // Expand search terms with synonyms
        function expandWithSynonyms(words) {
            const expanded = new Set(words);
            words.forEach(word => {
                // Add synonyms if this word has mappings
                if (synonymMap[word]) {
                    synonymMap[word].forEach(syn => expanded.add(syn));
                }
            });
            return Array.from(expanded);
        }

        // Bayesian Average calculation for fairer ranking
        function calculateBayesianScore(avgRating, reviewCount) {
            const C = 5;    // Confidence threshold (minimum reviews for full weight)
            const m = 3.5;  // Baseline/prior rating
            const v = reviewCount;
            const R = avgRating;
            
            // Bayesian Average: (v / (v + C)) * R + (C / (v + C)) * m
            return (v / (v + C)) * R + (C / (v + C)) * m;
        }

        function findBestToolsForTask(searchTask) {
            if (!searchTask || searchTask.length < CONFIG.LIMITS.MIN_SEARCH_LENGTH) return [];
            
            // Get search words and expand with synonyms
            const rawSearchWords = searchTask.toLowerCase().split(/\s+/).filter(w => w.length > 2);
            const searchWords = expandWithSynonyms(rawSearchWords);
            
            const results = new Map();
            
            AppState.allRatings.forEach(rating => {
                // Get words from all searchable fields (don't expand - keep original)
                const taskText = (rating.task || '').toLowerCase();
                const taskTypeText = (rating.taskType || '').toLowerCase();
                const feedbackText = (rating.feedback || '').toLowerCase();
                const toolNameText = (rating.toolName || '').toLowerCase();
                
                const taskWords = taskText.split(/\s+/).filter(w => w.length > 2);
                const taskTypeWords = taskTypeText.split(/\s+/).filter(w => w.length > 2);
                const feedbackWords = feedbackText.split(/\s+/).filter(w => w.length > 2);
                const toolNameWords = toolNameText.split(/\s+/).filter(w => w.length > 2);
                const allWords = [...taskWords, ...taskTypeWords, ...feedbackWords, ...toolNameWords];
                
                let similarity = 0;
                let matchedOriginalTerm = false;
                
                // Check each search word (including expanded synonyms)
                searchWords.forEach(sw => {
                    // Check if this is an original search term (not a synonym)
                    const isOriginalTerm = rawSearchWords.includes(sw);
                    
                    // Exact match in task description (highest priority)
                    if (taskWords.includes(sw)) {
                        similarity += isOriginalTerm ? 50 : 25;
                        if (isOriginalTerm) matchedOriginalTerm = true;
                    }
                    // Exact match in task type (high priority)
                    else if (taskTypeWords.includes(sw)) {
                        similarity += isOriginalTerm ? 30 : 15;
                        if (isOriginalTerm) matchedOriginalTerm = true;
                    }
                    // Exact match in tool name
                    else if (toolNameWords.includes(sw)) {
                        similarity += isOriginalTerm ? 25 : 12;
                        if (isOriginalTerm) matchedOriginalTerm = true;
                    }
                    // Exact match in feedback
                    else if (feedbackWords.includes(sw)) {
                        similarity += isOriginalTerm ? 35 : 15;
                        if (isOriginalTerm) matchedOriginalTerm = true;
                    }
                    // Partial match anywhere
                    else if (allWords.some(w => w.includes(sw) || sw.includes(w))) {
                        similarity += isOriginalTerm ? 10 : 5;
                        if (isOriginalTerm) matchedOriginalTerm = true;
                    }
                });
                
                // Only include results that matched at least one original search term
                // OR have high similarity from synonym matches
                if (matchedOriginalTerm && similarity > 20) {
                    const key = normalizeToolName(rating.toolName);
                    if (!results.has(key)) {
                        results.set(key, {
                            name: rating.toolName,
                            ratings: [],
                            tasks: [],
                            maxSimilarity: 0
                        });
                    }
                    
                    const tool = results.get(key);
                    tool.ratings.push(rating.rating);
                    tool.maxSimilarity = Math.max(tool.maxSimilarity, similarity);
                    tool.tasks.push({
                        task: rating.task,
                        taskType: rating.taskType || null,
                        feedback: rating.feedback,
                        reviewerName: rating.reviewerName || null,
                        rating: rating.rating,
                        createdAt: rating.createdAt,
                        similarity: similarity
                    });
                }
            });
            
            return Array.from(results.values())
                .map(tool => {
                    const avgRating = tool.ratings.reduce((a, b) => a + b, 0) / tool.ratings.length;
                    const reviewCount = tool.ratings.length;
                    const bayesianScore = calculateBayesianScore(avgRating, reviewCount);
                    
                    // Weighted score: relevance matters more than just rating
                    // Formula: (relevance * 2) + (bayesianScore * 10)
                    const weightedScore = (tool.maxSimilarity * 2) + (bayesianScore * 10);
                    
                    return {
                        name: tool.name,
                        avgRating: avgRating,
                        bayesianScore: bayesianScore,
                        relevance: tool.maxSimilarity,
                        weightedScore: weightedScore,
                        reviewCount: reviewCount,
                        tasks: tool.tasks.sort((a, b) => b.similarity - a.similarity || new Date(b.createdAt) - new Date(a.createdAt))
                    };
                })
                // Sort by weighted score (balances relevance + rating)
                .sort((a, b) => b.weightedScore - a.weightedScore)
                .slice(0, CONFIG.LIMITS.MAX_RATINGS_DISPLAY);
        }

        // ====================================
        // GIVE-TO-GET GROWTH FEATURE
        // ====================================
        
        function getSearchCount() {
            return parseInt(localStorage.getItem('aiToolsRank_searchCount') || '0');
        }
        
        function incrementSearchCount() {
            const count = getSearchCount() + 1;
            localStorage.setItem('aiToolsRank_searchCount', count.toString());
            return count;
        }
        
        function hasUserContributed() {
            // Check 1: localStorage flag (most reliable)
            if (localStorage.getItem('aiToolsRank_hasContributed') === 'true') {
                return true;
            }
            
            // Check 2: Check localStorage for user's own saved ratings
            // (Only local ratings count - these have IDs starting with 'local_')
            try {
                const savedRatings = localStorage.getItem('aiToolsRank_ratings');
                if (savedRatings) {
                    const parsed = JSON.parse(savedRatings);
                    if (Array.isArray(parsed) && parsed.length > 0) {
                        // User has saved ratings locally, mark as contributor
                        setUserContributed();
                        return true;
                    }
                }
            } catch (e) {
                console.error('Error checking saved ratings:', e);
            }
            
            return false;
        }
        
        function setUserContributed() {
            try {
                localStorage.setItem('aiToolsRank_hasContributed', 'true');
                // Also reset search count so the wall doesn't show
                localStorage.setItem('aiToolsRank_searchCount', '0');
                console.log('User marked as contributor - unlimited searches unlocked');
            } catch (e) {
                console.error('Error setting contributor status:', e);
            }
        }
        
        function showValueWall() {
            const resultsSection = document.getElementById('resultsSection');
            resultsSection.innerHTML = `
                <div class="relative">
                    <!-- Blurred background hint -->
                    <div class="opacity-30 blur-sm pointer-events-none">
                        <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-6 mb-4">
                            <div class="h-6 bg-slate-200 rounded w-1/3 mb-3"></div>
                            <div class="h-4 bg-slate-100 rounded w-full mb-2"></div>
                            <div class="h-4 bg-slate-100 rounded w-2/3"></div>
                        </div>
                        <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-6">
                            <div class="h-6 bg-slate-200 rounded w-1/4 mb-3"></div>
                            <div class="h-4 bg-slate-100 rounded w-full mb-2"></div>
                            <div class="h-4 bg-slate-100 rounded w-3/4"></div>
                        </div>
                    </div>
                    
                    <!-- Value Wall Modal Overlay -->
                    <div class="absolute inset-0 flex items-center justify-center p-4">
                        <div class="glassmorphism bg-white/95 backdrop-blur-xl rounded-2xl sm:rounded-3xl shadow-2xl border border-white/50 p-6 sm:p-10 max-w-md w-full text-center transform">
                            <!-- Lock Icon -->
                            <div class="w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-br from-indigo-500 to-violet-600 rounded-2xl sm:rounded-3xl flex items-center justify-center mx-auto mb-5 sm:mb-6 shadow-lg shadow-indigo-200">
                                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8 sm:w-10 sm:h-10">
                                    <rect width="18" height="11" x="3" y="11" rx="2" ry="2"/>
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                </svg>
                            </div>
                            
                            <!-- Headline -->
                            <h3 class="text-xl sm:text-2xl md:text-3xl font-bold text-slate-800 mb-2 sm:mb-3">
                                Unlock Unlimited Searches
                            </h3>
                            
                            <!-- Body -->
                            <p class="text-sm sm:text-base text-slate-600 mb-6 sm:mb-8 leading-relaxed">
                                You've found a great tool! To keep this community <strong>free and accurate</strong>, please contribute <strong>1 quick rating</strong> to unlock unlimited access.
                            </p>
                            
                            <!-- CTA Button -->
                            <button 
                                onclick="scrollToRatingForm()"
                                class="w-full bg-gradient-to-r from-indigo-600 to-violet-600 hover:from-indigo-700 hover:to-violet-700 text-white font-bold py-3.5 sm:py-4 px-6 sm:px-8 rounded-xl shadow-lg shadow-indigo-300 transform transition-all duration-200 active:scale-95 hover:scale-105 hover:shadow-xl animate-pulse-subtle text-sm sm:text-base"
                            >
                                <span class="flex items-center justify-center gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 sm:w-5 sm:h-5">
                                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                                    </svg>
                                    Rate a Tool to Unlock
                                </span>
                            </button>
                            
                            <!-- Trust signal -->
                            <p class="text-xs text-slate-400 mt-3 sm:mt-4">
                                ‚ö° Takes less than 30 seconds
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function scrollToRatingForm() {
            document.getElementById('ratingForm').scrollIntoView({ behavior: 'smooth', block: 'start' });
            setTimeout(() => {
                document.getElementById('toolName').focus();
            }, 500);
        }

        function performSearch(event) {
            if (event) event.preventDefault();
            
            const query = document.getElementById('searchInput').value.trim();
            
            if (query.length < CONFIG.LIMITS.MIN_SEARCH_LENGTH) {
                document.getElementById('searchResults').innerHTML = `
                    <div class="text-center py-8 text-slate-500">
                        <p>Enter at least 2 characters</p>
                    </div>
                `;
                return;
            }
            
            // Track search event in GA4
            if (typeof gtag !== 'undefined') {
                gtag('event', 'search', {
                    search_term: query
                });
            }
            
            // Give-to-Get: Check if user can search
            if (!hasUserContributed()) {
                const searchCount = getSearchCount();
                if (searchCount >= 1) {
                    // User has used their free search - show Value Wall
                    showValueWall();
                    return;
                }
                // Note: We'll increment AFTER showing results with Smart Increment logic
            }
            
            // Show loading skeleton
            document.getElementById('searchResults').innerHTML = `
                <div class="skeleton skeleton-card"></div>
                <div class="skeleton skeleton-card"></div>
            `;
            
            clearTimeout(AppState.searchTimeout);
            AppState.searchTimeout = setTimeout(() => {
                const results = findBestToolsForTask(query);
                displayResults(query, results);
                lucide.createIcons();
                
                // Give-to-Get: Smart Increment (Prevents blocking while typing)
                if (!hasUserContributed() && results.length > 0) {
                    const lastTerm = localStorage.getItem('aiToolsRank_lastSearchTerm') || '';
                    const currentTerm = query.toLowerCase();
                    
                    // Only increment if this is a NEW topic (not just typing/backspacing)
                    // We check if the new term is completely different from the last one
                    if (lastTerm !== '' && !currentTerm.includes(lastTerm) && !lastTerm.includes(currentTerm)) {
                        incrementSearchCount();
                    }
                    
                    // Update the last term for the next keystroke check
                    localStorage.setItem('aiToolsRank_lastSearchTerm', currentTerm);
                }
            }, CONFIG.LIMITS.SEARCH_DEBOUNCE);
        }

        function searchForTask(task) {
            document.getElementById('searchInput').value = task;
            performSearch();
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric', 
                    year: 'numeric' 
                });
            } catch (e) {
                return '';
            }
        }

        function toggleReviews(toolId) {
            const container = document.getElementById(`reviews-${toolId}`);
            const button = document.getElementById(`btn-${toolId}`);
            const icon = document.getElementById(`icon-${toolId}`);
            const text = document.getElementById(`text-${toolId}`);
            
            if (container.classList.contains('expanded')) {
                container.classList.remove('expanded');
                icon.setAttribute('data-lucide', 'chevron-down');
                text.textContent = 'View all reviews';
            } else {
                container.classList.add('expanded');
                icon.setAttribute('data-lucide', 'chevron-up');
                text.textContent = 'Show less';
            }
            lucide.createIcons();
        }

        // ====================================
        // TOOL NAME AUTOCOMPLETE
        // ====================================
        
        function getKnownTools() {
            // Get unique tool names from all ratings
            const toolNames = new Set();
            AppState.allRatings.forEach(rating => {
                if (rating.toolName) {
                    toolNames.add(rating.toolName);
                }
            });
            return Array.from(toolNames).sort();
        }
        
        function showToolSuggestions(query) {
            const suggestionsContainer = document.getElementById('toolSuggestions');
            
            if (!query || query.length < 1) {
                suggestionsContainer.classList.add('hidden');
                return;
            }
            
            const knownTools = getKnownTools();
            const queryLower = query.toLowerCase();
            
            // Filter tools that match the query
            const matches = knownTools.filter(tool => 
                tool.toLowerCase().includes(queryLower)
            ).slice(0, 8); // Limit to 8 suggestions
            
            if (matches.length === 0) {
                suggestionsContainer.classList.add('hidden');
                return;
            }
            
            // Build suggestions HTML
            suggestionsContainer.innerHTML = matches.map((tool, index) => {
                // Highlight matching part
                const matchIndex = tool.toLowerCase().indexOf(queryLower);
                const before = tool.substring(0, matchIndex);
                const match = tool.substring(matchIndex, matchIndex + query.length);
                const after = tool.substring(matchIndex + query.length);
                
                return `
                    <button
                        type="button"
                        class="w-full px-4 py-3 text-left hover:bg-indigo-50 active:bg-indigo-100 transition-colors flex items-center gap-3 border-b border-slate-100 last:border-0"
                        onclick="selectToolSuggestion('${sanitizeHTML(tool).replace(/'/g, "\\'")}')"
                    >
                        <div class="w-8 h-8 bg-gradient-to-br from-indigo-100 to-violet-100 rounded-lg flex items-center justify-center flex-shrink-0">
                            <i data-lucide="sparkles" class="w-4 h-4 text-indigo-600"></i>
                        </div>
                        <span class="text-slate-700">
                            ${sanitizeHTML(before)}<strong class="text-indigo-600">${sanitizeHTML(match)}</strong>${sanitizeHTML(after)}
                        </span>
                    </button>
                `;
            }).join('');
            
            suggestionsContainer.classList.remove('hidden');
            lucide.createIcons();
        }
        
        function selectToolSuggestion(toolName) {
            const toolNameInput = document.getElementById('toolName');
            toolNameInput.value = toolName;
            document.getElementById('toolSuggestions').classList.add('hidden');
            updateStepButtons();
            toolNameInput.focus();
        }
        
        function hideToolSuggestions() {
            // Delay hiding to allow click events to fire
            setTimeout(() => {
                document.getElementById('toolSuggestions').classList.add('hidden');
            }, 200);
        }

        // ====================================
        // MULTI-STEP FORM NAVIGATION
        // ====================================
        
        function goToStep(step) {
            // Validate current step before proceeding
            if (step > AppState.currentStep) {
                if (!validateStep(AppState.currentStep)) {
                    return;
                }
            }
            
            // Hide all steps
            document.querySelectorAll('.form-step').forEach(el => {
                el.classList.add('hidden');
            });
            
            // Show target step
            document.getElementById(`formStep${step}`).classList.remove('hidden');
            
            // Update progress bar
            const progress = (step / 3) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
            
            // Update step counter
            document.getElementById('stepCounter').textContent = `Step ${step} of 3`;
            
            // Update state
            AppState.currentStep = step;
            
            // Reinitialize icons
            lucide.createIcons();
            
            // Scroll form into view
            document.getElementById('ratingForm').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        function validateStep(step) {
            if (step === 1) {
                const toolName = document.getElementById('toolName').value.trim();
                if (!toolName) {
                    document.getElementById('toolName').focus();
                    document.getElementById('toolName').classList.add('border-rose-500');
                    setTimeout(() => {
                        document.getElementById('toolName').classList.remove('border-rose-500');
                    }, 2000);
                    return false;
                }
                return true;
            }
            
            if (step === 2) {
                const hasRating = AppState.selectedRating > 0;
                const hasTaskType = AppState.selectedTaskType !== null;
                
                if (!hasRating || !hasTaskType) {
                    // Show visual feedback
                    if (!hasRating) {
                        document.getElementById('starRating').classList.add('animate-pulse');
                        setTimeout(() => {
                            document.getElementById('starRating').classList.remove('animate-pulse');
                        }, 1000);
                    }
                    if (!hasTaskType) {
                        document.getElementById('taskTypeChips').classList.add('animate-pulse');
                        setTimeout(() => {
                            document.getElementById('taskTypeChips').classList.remove('animate-pulse');
                        }, 1000);
                    }
                    return false;
                }
                return true;
            }
            
            return true;
        }
        
        function updateStepButtons() {
            // Step 1: Enable next if tool name is filled
            const toolName = document.getElementById('toolName').value.trim();
            const step1Btn = document.getElementById('step1NextBtn');
            if (step1Btn) {
                step1Btn.disabled = !toolName;
            }
            
            // Step 2: Enable next if rating AND task type are selected
            const step2Btn = document.getElementById('step2NextBtn');
            if (step2Btn) {
                step2Btn.disabled = !(AppState.selectedRating > 0 && AppState.selectedTaskType);
            }
        }

        // Quick-Tap Rating: Pre-fill form and jump to Step 2
        function quickRate(toolName, rating) {
            // Pre-fill the tool name (Step 1)
            document.getElementById('toolName').value = toolName;
            
            // Pre-select the star rating (Step 2)
            AppState.selectedRating = rating;
            document.querySelectorAll('#starRating .star-btn').forEach((star, idx) => {
                const starIcon = star.querySelector('[data-lucide="star"]');
                if (starIcon) {
                    if (idx < rating) {
                        starIcon.classList.remove('fill-slate-200', 'text-slate-300');
                        starIcon.classList.add('fill-amber-400', 'text-amber-400');
                    } else {
                        starIcon.classList.remove('fill-amber-400', 'text-amber-400');
                        starIcon.classList.add('fill-slate-200', 'text-slate-300');
                    }
                }
            });
            
            // Update button states
            updateStepButtons();
            
            // Jump directly to Step 2 (skipping Step 1 since tool name is pre-filled)
            goToStep(2);
            
            // Reinitialize icons after DOM update
            setTimeout(() => {
                lucide.createIcons();
            }, 100);
        }

        function highlightText(text, query) {
            if (!query) return sanitizeHTML(text);
            const words = query.toLowerCase().split(/\s+/).filter(w => w.length > 2);
            let result = sanitizeHTML(text);
            words.forEach(word => {
                const regex = new RegExp(`(${word})`, 'gi');
                result = result.replace(regex, '<span class="highlight-text">$1</span>');
            });
            return result;
        }

        function generateStars(rating, filled = true) {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= rating) {
                    stars += `<i data-lucide="star" class="w-4 h-4 fill-amber-400 text-amber-400"></i>`;
                } else {
                    stars += `<i data-lucide="star" class="w-4 h-4 fill-slate-200 text-slate-200"></i>`;
                }
            }
            return stars;
        }

        function displayResults(query, results) {
            const container = document.getElementById('searchResults');
            const sanitizedQuery = sanitizeHTML(query);
            
            if (results.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8">
                        <i data-lucide="search-x" class="w-12 h-12 mx-auto mb-4 text-slate-300"></i>
                        <p class="text-slate-700">No tools found for "${sanitizedQuery}"</p>
                        <p class="text-slate-500 mt-2">Be the first to rate a tool for this task!</p>
                    </div>
                `;
                lucide.createIcons();
                return;
            }
            
            const resultsHTML = results.map((tool, index) => {
                const toolId = `tool-${index}`;
                const hasMoreReviews = tool.tasks.length > 1;
                const previewReview = tool.tasks[0];
                const additionalReviews = tool.tasks.slice(1);
                
                // Debug logging - check console to see values
                console.log(`Tool: ${tool.name}, Index: ${index}, Relevance: ${tool.relevance}, Show Badge: ${tool.relevance >= 20 && index === 0}`);
                
                // Best Match badge - shows when #1 ranked result has high relevance (>=20)
                // This fixes the badge not showing when a relevant tool is ranked #1
                const bestMatchBadge = tool.relevance >= 20 && index === 0 ? `
                    <span class="inline-flex items-center gap-1.5 ml-2 bg-indigo-500 text-white text-xs font-semibold px-3 py-1.5 rounded-full shadow-md shadow-indigo-300">
                        <i data-lucide="target" class="w-3 h-3"></i> Best Match
                    </span>
                ` : '';
                
                // Badge based on rank
                let badgeHTML = '';
                if (index === 0) {
                    badgeHTML = `
                        <div class="absolute -top-3 -right-3 bg-gradient-to-br from-amber-400 to-amber-600 text-white w-14 h-14 rounded-2xl flex items-center justify-center shadow-lg shadow-amber-200 transform rotate-12">
                            <i data-lucide="trophy" class="w-7 h-7 -rotate-12"></i>
                        </div>
                    `;
                } else if (index === 1) {
                    badgeHTML = `
                        <div class="absolute -top-3 -right-3 bg-gradient-to-br from-slate-300 to-slate-500 text-white w-14 h-14 rounded-2xl flex items-center justify-center shadow-lg shadow-slate-200 transform rotate-12">
                            <i data-lucide="medal" class="w-7 h-7 -rotate-12"></i>
                        </div>
                    `;
                } else if (index === 2) {
                    badgeHTML = `
                        <div class="absolute -top-3 -right-3 bg-gradient-to-br from-orange-400 to-orange-600 text-white w-14 h-14 rounded-2xl flex items-center justify-center shadow-lg shadow-orange-200 transform rotate-12">
                            <i data-lucide="award" class="w-7 h-7 -rotate-12"></i>
                        </div>
                    `;
                }
                
                return `
                    <div class="card-hover relative bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden mb-6">
                        ${badgeHTML}
                        
                        <div class="p-5 sm:p-6">
                            <div class="flex items-start justify-between mb-4 ${index < 3 ? 'pr-12' : ''}">
                                <div>
                                    <div class="flex items-center flex-wrap">
                                        <h3 class="text-lg sm:text-xl font-bold text-slate-800">${sanitizeHTML(tool.name)}</h3>
                                        ${bestMatchBadge}
                                    </div>
                                    <div class="flex items-center gap-2 sm:gap-3 mt-2 flex-wrap">
                                        <div class="flex gap-0.5">
                                            ${generateStars(Math.round(tool.avgRating))}
                                        </div>
                                        <span class="text-base sm:text-lg font-semibold text-slate-700">${tool.avgRating.toFixed(1)}</span>
                                        <span class="text-sm text-slate-400">(${tool.reviewCount} ${tool.reviewCount === 1 ? 'review' : 'reviews'})</span>
                                    </div>
                                </div>
                            </div>

                            <!-- First Review (always visible) -->
                            <div class="bg-slate-50 rounded-xl p-4 border-l-4 border-indigo-400">
                                <div class="flex items-start justify-between mb-2 gap-2">
                                    <p class="text-sm font-medium text-slate-700">
                                        ${highlightText(previewReview.task, query)}
                                    </p>
                                    <span class="text-xs text-slate-400 whitespace-nowrap">${formatDate(previewReview.createdAt)}</span>
                                </div>
                                <p class="text-sm text-slate-600 italic mb-1">"${sanitizeHTML(previewReview.feedback)}"</p>
                                <p class="text-xs text-slate-400 text-right mb-2">‚Äî ${previewReview.reviewerName ? sanitizeHTML(previewReview.reviewerName) : 'Verified User'}</p>
                                <div class="flex items-center justify-between flex-wrap gap-2">
                                    <div class="flex gap-0.5">
                                        ${generateStars(previewReview.rating)}
                                    </div>
                                    ${previewReview.taskType ? `<span class="text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded-full">${sanitizeHTML(previewReview.taskType)}</span>` : ''}
                                </div>
                            </div>

                            <!-- Additional Reviews (expandable) -->
                            ${hasMoreReviews ? `
                                <div class="reviews-expandable space-y-3 mt-3" id="reviews-${toolId}">
                                    ${additionalReviews.map(t => `
                                        <div class="bg-slate-50 rounded-xl p-4 border-l-4 border-indigo-400">
                                            <div class="flex items-start justify-between mb-2 gap-2">
                                                <p class="text-sm font-medium text-slate-700">
                                                    ${highlightText(t.task, query)}
                                                </p>
                                                <span class="text-xs text-slate-400 whitespace-nowrap">${formatDate(t.createdAt)}</span>
                                            </div>
                                            <p class="text-sm text-slate-600 italic mb-1">"${sanitizeHTML(t.feedback)}"</p>
                                            <p class="text-xs text-slate-400 text-right mb-2">‚Äî ${t.reviewerName ? sanitizeHTML(t.reviewerName) : 'Verified User'}</p>
                                            <div class="flex items-center justify-between flex-wrap gap-2">
                                                <div class="flex gap-0.5">
                                                    ${generateStars(t.rating)}
                                                </div>
                                                ${t.taskType ? `<span class="text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded-full">${sanitizeHTML(t.taskType)}</span>` : ''}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                                <button
                                    onclick="toggleReviews('${toolId}')"
                                    id="btn-${toolId}"
                                    class="mt-4 w-full py-2 text-sm font-medium text-indigo-600 hover:text-indigo-800 flex items-center justify-center gap-1 transition-colors rounded-lg hover:bg-indigo-50"
                                >
                                    <i data-lucide="chevron-down" class="w-4 h-4" id="icon-${toolId}"></i>
                                    <span id="text-${toolId}">View all ${tool.tasks.length} reviews</span>
                                </button>
                            ` : ''}
                            
                            <!-- Quick-Tap Rating - Enhanced CTA -->
                            <div class="mt-4 pt-4 border-t border-slate-200 bg-gradient-to-r from-amber-50/50 to-orange-50/50 -mx-5 sm:-mx-6 px-5 sm:px-6 pb-5 sm:pb-6 -mb-5 sm:-mb-6 rounded-b-2xl">
                                <div class="flex items-center justify-between flex-wrap gap-3">
                                    <div class="flex items-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-amber-500">
                                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                                        </svg>
                                        <span class="text-sm font-semibold text-slate-700">Rate this tool:</span>
                                    </div>
                                    <div class="flex gap-1 bg-white rounded-xl p-1.5 shadow-sm border border-slate-100">
                                        ${[1,2,3,4,5].map(star => `
                                            <button 
                                                onclick="quickRate('${sanitizeHTML(tool.name).replace(/'/g, "\\'")}', ${star})"
                                                class="w-9 h-9 flex items-center justify-center rounded-lg hover:bg-amber-100 transition-all duration-200 group hover:scale-110"
                                                title="Rate ${star} star${star > 1 ? 's' : ''}"
                                            >
                                                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-amber-300 group-hover:text-amber-400 group-hover:fill-amber-400 transition-colors">
                                                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                                                </svg>
                                            </button>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = `
                <h2 class="text-xl sm:text-2xl font-bold text-slate-800 mb-6">
                    Results for "<span class="text-indigo-600">${sanitizedQuery}</span>"
                </h2>
                ${resultsHTML}
            `;
            
            lucide.createIcons();
        }

        // ====================================
        // RATING SUBMISSION
        // ====================================
        
        async function submitRating(event) {
            event.preventDefault();
            
            if (!canSubmit()) {
                showError('Please wait before submitting again');
                return;
            }
            
            const toolName = document.getElementById('toolName').value.trim();
            const taskDescription = document.getElementById('taskDescription').value.trim();
            const userFeedback = document.getElementById('userFeedback').value.trim();
            const reviewerName = document.getElementById('reviewerName').value.trim();
            
            if (!validateInput(toolName, CONFIG.LIMITS.MAX_TOOL_NAME)) {
                showError('Tool name is invalid or too long');
                return;
            }
            
            if (!validateInput(taskDescription, CONFIG.LIMITS.MAX_TASK_DESC)) {
                showError('Task description is required');
                return;
            }
            
            if (!validateInput(userFeedback, CONFIG.LIMITS.MAX_FEEDBACK)) {
                showError('Feedback is required');
                return;
            }
            
            if (!validateRating(AppState.selectedRating)) {
                showError('Please select a star rating');
                return;
            }
            
            AppState.isSubmitting = true;
            AppState.lastSubmitTime = Date.now();
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            document.getElementById('submitBtnText').textContent = 'Saving...';
            
            try {
                const formData = {
                    toolName: sanitizeHTML(toolName),
                    task: sanitizeHTML(taskDescription.toLowerCase()),
                    taskType: AppState.selectedTaskType || null,
                    feedback: sanitizeHTML(userFeedback),
                    reviewerName: sanitizeHTML(reviewerName),
                    rating: AppState.selectedRating,
                    createdAt: new Date().toISOString(),
                    timestamp: Date.now()
                };
                
                let submitted = false;
                if (AppState.isConnected && AppState.db) {
                    try {
                        const docRef = await AppState.db.collection('ratings').add(formData);
                        formData.id = docRef.id;
                        submitted = true;
                    } catch (err) {
                        console.error('Firebase error:', err);
                        // Continue with local save even if Firebase fails
                    }
                }
                
                if (!submitted) {
                    formData.id = 'local_' + Date.now();
                }
                
                AppState.allRatings.unshift(formData);
                saveLocalRatings();
                updateStats();
                
                // Give-to-Get: ALWAYS mark user as contributor after form completion
                // This is the critical fix - set it before anything else can fail
                setUserContributed();
                const wasFirstContribution = getSearchCount() > 0; // They had searched before
                
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'tool_ranking_submitted', {
                        tool_name: sanitizeHTML(toolName),
                        task_type: AppState.selectedTaskType || 'not_specified',
                        rating: AppState.selectedRating
                    });
                }
                
                // Show appropriate success message
                if (wasFirstContribution) {
                    showSuccess('üéâ Unlimited Searches Unlocked!');
                } else {
                    showSuccess(submitted ? 'Rating submitted!' : 'Saved locally');
                }
                
                // Clear the Value Wall if it was showing
                const searchResultsEl = document.getElementById('searchResults');
                if (searchResultsEl && searchResultsEl.innerHTML.includes('Unlock Unlimited')) {
                    searchResultsEl.innerHTML = '';
                }
                
                // Reset form
                document.getElementById('ratingForm').reset();
                AppState.selectedRating = 0;
                AppState.selectedTaskType = null;
                updateStars();
                clearTaskType();
                updateCharCounter('taskDescription');
                updateCharCounter('userFeedback');
                
                // Reset to Step 1
                goToStep(1);
                updateStepButtons();
                
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
            } catch (error) {
                console.error('Submit error:', error);
                showError('Failed to submit. Please try again.');
            } finally {
                AppState.isSubmitting = false;
                submitBtn.disabled = false;
                document.getElementById('submitBtnText').textContent = 'Submit Rating ‚úì';
            }
        }

        // ====================================
        // UI FUNCTIONS
        // ====================================
        
        function updateConnectionStatus(status) {
            // Connection status banner removed - function kept for compatibility
            console.log('Connection status:', status);
        }

        function showSuccess(message) {
            const el = document.getElementById('successMessage');
            document.getElementById('successText').textContent = message;
            el.classList.add('show');
            setTimeout(() => el.classList.remove('show'), 4000);
        }

        function showError(message) {
            const el = document.getElementById('errorMessage');
            document.getElementById('errorText').textContent = message;
            el.classList.add('show');
            setTimeout(() => el.classList.remove('show'), 4000);
        }

        function updateStats() {
            const tools = new Set();
            const tasks = new Set();
            let totalRating = 0;
            let count = 0;
            
            AppState.allRatings.forEach(r => {
                tools.add(normalizeToolName(r.toolName));
                tasks.add(r.task?.toLowerCase());
                totalRating += r.rating || 0;
                count++;
            });
            
            // Update stats elements if they exist (stats bar may be removed)
            const toolCountEl = document.getElementById('toolCount');
            const taskCountEl = document.getElementById('taskCount');
            const ratingCountEl = document.getElementById('ratingCount');
            const avgRatingEl = document.getElementById('avgRating');
            
            if (toolCountEl) toolCountEl.textContent = tools.size;
            if (taskCountEl) taskCountEl.textContent = tasks.size;
            if (ratingCountEl) ratingCountEl.textContent = AppState.allRatings.length;
            if (avgRatingEl) avgRatingEl.textContent = count ? (totalRating / count).toFixed(1) : '0.0';
        }

        function updateCharCounter(fieldId) {
            const field = document.getElementById(fieldId);
            const counter = document.getElementById(fieldId === 'taskDescription' ? 'taskCounter' : 'feedbackCounter');
            
            if (!field || !counter) return;
            
            const length = field.value.length;
            const max = fieldId === 'taskDescription' ? CONFIG.LIMITS.MAX_TASK_DESC : CONFIG.LIMITS.MAX_FEEDBACK;
            
            counter.textContent = `${length}/${max}`;
            counter.className = 'text-right text-xs mt-1';
            
            if (length >= max) {
                counter.classList.add('text-red-500');
            } else if (length >= max * 0.9) {
                counter.classList.add('text-amber-500');
            } else {
                counter.classList.add('text-slate-400');
            }
        }

        function updateStars() {
            document.querySelectorAll('.star-btn').forEach((btn, index) => {
                const icon = btn.querySelector('.star-icon');
                const isActive = index < AppState.selectedRating;
                
                if (isActive) {
                    icon.classList.remove('fill-slate-200', 'text-slate-300');
                    icon.classList.add('fill-amber-400', 'text-amber-400');
                } else {
                    icon.classList.remove('fill-amber-400', 'text-amber-400');
                    icon.classList.add('fill-slate-200', 'text-slate-300');
                }
            });
        }

        function selectTaskType(type) {
            document.querySelectorAll('.task-chip').forEach(chip => {
                chip.classList.remove('chip-selected');
            });
            
            const selectedChip = document.querySelector(`.task-chip[data-type="${type}"]`);
            if (selectedChip) {
                selectedChip.classList.add('chip-selected');
            }
            
            AppState.selectedTaskType = type;
        }

        function clearTaskType() {
            document.querySelectorAll('.task-chip').forEach(chip => {
                chip.classList.remove('chip-selected');
            });
            AppState.selectedTaskType = null;
        }

        // ====================================
        // EVENT LISTENERS
        // ====================================
        
        function setupEventListeners() {
            // Search
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', () => {
                clearTimeout(AppState.searchTimeout);
                if (searchInput.value.length >= CONFIG.LIMITS.MIN_SEARCH_LENGTH) {
                    AppState.searchTimeout = setTimeout(performSearch, CONFIG.LIMITS.SEARCH_DEBOUNCE);
                }
            });
            
            // Form
            document.getElementById('ratingForm').addEventListener('submit', submitRating);
            
            // Step 1: Tool Name input - enable/disable Next button + autocomplete
            const toolNameInput = document.getElementById('toolName');
            toolNameInput.addEventListener('input', function() {
                updateStepButtons();
                showToolSuggestions(this.value.trim());
            });
            toolNameInput.addEventListener('focus', function() {
                if (this.value.trim().length >= 1) {
                    showToolSuggestions(this.value.trim());
                }
            });
            toolNameInput.addEventListener('blur', hideToolSuggestions);
            
            // Character counters
            document.getElementById('taskDescription').addEventListener('input', () => updateCharCounter('taskDescription'));
            document.getElementById('userFeedback').addEventListener('input', () => updateCharCounter('userFeedback'));
            
            // Task Type chips - with step button update
            document.querySelectorAll('.task-chip').forEach(chip => {
                chip.addEventListener('click', function() {
                    const type = this.dataset.type;
                    if (AppState.selectedTaskType === type) {
                        clearTaskType();
                    } else {
                        selectTaskType(type);
                    }
                    updateStepButtons(); // Update Step 2 Next button
                });
            });
            
            // Star rating - with step button update
            document.querySelectorAll('.star-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    AppState.selectedRating = parseInt(this.dataset.rating);
                    updateStars();
                    updateStepButtons(); // Update Step 2 Next button
                });
                
                btn.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    AppState.selectedRating = parseInt(this.dataset.rating);
                    updateStars();
                    updateStepButtons(); // Update Step 2 Next button
                    if (window.navigator.vibrate) {
                        window.navigator.vibrate(10);
                    }
                });
            });
            
            // Initialize step buttons state
            updateStepButtons();
        }

        // ====================================
        // INITIALIZATION
        // ====================================
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
        
        window.addEventListener('beforeunload', saveLocalRatings);
    </script>
</body>
</html>

